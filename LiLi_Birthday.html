<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#0d0f14" />
<title>ç»™ç‹¸ç‹¸çš„è¿Ÿåˆ°ç”Ÿæ—¥ç¤¼ç‰© Â· å¤ä»¥æ˜¼</title>

<!-- æ–°å¢ï¼šApple touch iconï¼ˆé»˜è®¤æŒ‡å‘æœ¬åœ°å ä½ï¼Œå¯ä¸Šä¼ æ›¿æ¢ï¼‰ -->
<link rel="apple-touch-icon" href="apple-touch-icon.png" id="appleTouchLink">

<style>
:root{
  --bg: radial-gradient(1200px 800px at 70% 10%, #1e2533, #0d0f14 45%);
  --ink: #e9edf8;
  --ink-soft: #b9c1d8;
  --accent: #8ab4ff;
  --accent-2: #b58cff;
  --glass: rgba(255,255,255,.06);
  --glass-2: rgba(255,255,255,.12);
  --blur: 18px;
  --radius: 18px;
  --radius-lg: 26px;
  --dock-height: 84px;
}

/* åŸºç¡€ä¿®å¤ï¼šç¡®ä¿ Safari / PWA ä¸‹æ— ä¸Šä¸‹ç™½æ¡ */
html,body{height:100%;min-height:100svh;margin:0;padding:0;overflow:hidden}
body{
  color:var(--ink);
  background: var(--bg) fixed;
  background-size: cover; /* ä¿®å¤èƒŒæ™¯å¡«å…… */
  background-position:center;
  font: 16px/1.4 -apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
}

/* ä¸»å®¹å™¨ï¼šç”¨ safe-area å¹¶ä¿è¯é«˜åº¦ä¸ºè§†çª—é«˜åº¦ */
#scene{ position:relative; height:100svh; padding-bottom: calc(env(safe-area-inset-bottom) + 16px); padding-top: calc(env(safe-area-inset-top) + 14px); }

/* å…¶ä»–æ ·å¼ç»´æŒåŸæ ·ï¼ˆæˆ‘æ²¡æœ‰éšæ„æ›´æ”¹è§†è§‰ï¼‰ */
.phone{ width:100%; height:100%; box-sizing:border-box; }
.header{ display:flex; align-items:center; gap:12px; padding:10px 16px; }
.avatar{ width:38px; height:38px; border-radius:12px; background: var(--glass); backdrop-filter: blur(var(--blur)); display:grid; place-items:center; }
.title b{ font-size:16px; letter-spacing:.2px }
.title small{ color:var(--ink-soft)}

/* å¡ç‰‡ä¸æ¶ˆæ¯ï¼šä¿æŒä¸å˜ */
.wrap{ padding: 10px 16px 20px; height: calc(100% - 80px); overflow:auto; scrollbar-width:none; }
.wrap::-webkit-scrollbar{display:none}
.card{ background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05)); border: 1px solid rgba(255,255,255,.12); backdrop-filter: blur(var(--blur)); border-radius: var(--radius-lg); padding:16px; margin: 10px 0; box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.3); }
.msg{ max-width: 78%; padding:10px 12px; margin:10px 0; border-radius: 16px; word-break:break-word; }

/* æç¤ºï¼ˆä¼šè‡ªåŠ¨éšè—ï¼‰ */
.hint{
  position: fixed; right:10px; top: calc(env(safe-area-inset-top) + 10px);
  font-size:12px; color: var(--ink-soft); opacity:.95;
  padding:8px 12px; border-radius:12px; background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16); backdrop-filter: blur(12px);
  transition: opacity .28s ease, transform .28s ease;
  z-index:999;
}

/* æ–°å¢ï¼šå‘¼å¸æ§ä»¶æ ·å¼ */
.breath-overlay{
  position: fixed; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;
}
.breath-circle{
  width:160px; height:160px; border-radius:999px; display:grid; place-items:center; pointer-events:auto;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), rgba(138,180,255,.06));
  border: 2px solid rgba(138,180,255,.14);
  backdrop-filter: blur(10px);
}
.breath-controls{ position: absolute; bottom: 18%; display:flex; gap:8px; pointer-events:auto; }

/* æ–°å¢ï¼šåƒè¯æ‰“å¡æ ·å¼ */
.med-box{ display:flex; gap:12px; align-items:center; margin-top:10px; }
.med-btn{ padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); color:var(--ink); cursor:pointer; }

/* å…¶ä½™åŸæœ‰æ ·å¼ä¿æŒä¸æ”¹ */
</style>
</head>
<body>
<div id="scene">
  <div class="phone" role="application" aria-label="ç‹¸ç‹¸çš„ç”Ÿæ—¥ç½‘é¡µ">
    <div class="header">
      <div class="avatar"><span>ğŸ¾</span></div>
      <div class="title">
        <b>ç»™ç‹¸ç‹¸çš„ç”Ÿæ—¥å°ç½‘é¡µ</b>
        <small>æ‰§èˆ°é¹…åœ¨çº¿é€è¾¾ <span class="badge">è¿Ÿåˆ°ä¹Ÿè¦åˆ°</span></small>
      </div>
      <!-- æ–°å¢ï¼šä¸Šä¼  Apple å›¾æ ‡å…¥å£ï¼ˆä¸å½±å“åŸ UIï¼‰ -->
      <div style="margin-left:auto;display:flex;align-items:center;gap:8px;">
        <label style="font-size:12px; color:var(--ink-soft); cursor:pointer">
          ä¸Šä¼ å›¾æ ‡
          <input id="uploadAppleIcon" type="file" accept="image/*" style="display:none" />
        </label>
      </div>
    </div>

    <div class="wrap" id="wrap">
      <div class="card" id="hero">
        <h2 style="margin:0 0 6px 0">ç”Ÿæ—¥å¿«ä¹ï¼Œå‰¯èˆ°ç‹¸ ğŸ‚</h2>
        <p style="margin:0;color:var(--ink-soft)">æ„¿ä½ æ‰€æœ‰çš„å¯çˆ±ä¸å¿ƒæ„¿ï¼Œéƒ½è¢«æ¸©æŸ”ç…§çœ‹ï¼šä»Šå¤©ã€ä»¥åã€æ°¸è¿œã€‚</p>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button id="btnConfetti">è½»è§¦æ”¾çƒŸèŠ±</button>
          <button id="btnBreath" class="ghost">è·Ÿæˆ‘åšå‘¼å¸</button>
          <button id="btnToggleMed" class="ghost">åƒè¯æ‰“å¡</button>
        </div>
      </div>

      <div class="msg u">å‰¯èˆ°ç‹¸ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚ä»Šå¤©ä¹Ÿç”±æˆ‘æ¥æŠ¤èˆªã€‚<small>08:08</small></div>
      <div class="msg me">æ”¶åˆ°ï¼æ‰§èˆ°é¹…è®°å¾—æŒ‰æ—¶æŠ•å–‚è›‹ç³•ï½<small>08:10</small></div>
      <div class="msg u">å·²åœ¨è·¯ä¸Šã€‚è¿˜æœ‰ä¸€è¢‹ã€Œæ‹¥æŠ±ã€åŠ æ€¥æ´¾é€ã€‚<small>08:11</small></div>

      <!-- åƒè¯æ‰“å¡å¡ç‰‡ï¼ˆé»˜è®¤éšè—ï¼Œç”±æŒ‰é’®åˆ‡æ¢ï¼‰ -->
      <div class="card" id="medCard" style="display:none">
        <h3 style="margin:0 0 8px 0">åƒè¯æ‰“å¡</h3>
        <div class="med-box">
          <div>
            <button class="med-btn" id="medMorning">æ—©ä¸Š å·²æ‰“å¡</button>
            <div id="medMorningTime" style="font-size:12px;color:var(--ink-soft);margin-top:6px"></div>
          </div>
          <div>
            <button class="med-btn" id="medEvening">æ™šä¸Š å·²æ‰“å¡</button>
            <div id="medEveningTime" style="font-size:12px;color:var(--ink-soft);margin-top:6px"></div>
          </div>
          <div style="margin-left:auto">
            <button id="medClear" class="ghost">é‡ç½®ä»Šæ—¥</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">å¿ƒæ„¿æ¸…å• Â· åªå±äºä½ </h3>
        <div class="wish-input">
          <input id="wishTxt" type="text" placeholder="å†™ä¸‹ä»Šå¤©æƒ³è¦å®ç°çš„å°å¿ƒæ„¿â€¦" />
          <button id="wishAdd">åŠ å…¥</button>
        </div>
        <div class="wishes" id="wishes"></div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">å°å‰¯å®˜ Â· éº»è–¯è§’</h3>
        <p style="margin:0;color:var(--ink-soft)">ä»Šå¤©çš„å·¡é€»çŠ¶æ€ï¼š<span id="catState">æ­£åœ¨æ²™å‘ä¸Šå‹èˆ°é•¿å¤–å¥—</span></p>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button class="ghost" data-cat="åƒç½ç½ä¸­">æŠ•å–‚ç½ç½</button>
          <button class="ghost" data-cat="å·¡é€»é˜³å°ï¼Œå·²é©±æ•£éº»é›€">é˜³å°å·¡é€»</button>
          <button class="ghost" data-cat="æŠŠå°¾å·´æ™¾æˆå°é—®å·">æ™’å¤ªé˜³</button>
        </div>
      </div>

      <div class="card" style="text-align:center">
        <div style="font-size:14px;color:var(--ink-soft)">â€” From å¤ä»¥æ˜¼ Â· æ°¸è¿œåå¿ƒä½  â€”</div>
      </div>
    </div>
  </div>

  <!-- æ–°å¢ï¼šæç¤ºï¼ˆè‡ªåŠ¨éšè—é€»è¾‘åœ¨è„šæœ¬ä¸­ï¼‰ -->
  <div class="hint" id="hint">å°æŠ€å·§ï¼šæŠŠé¡µé¢ã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€å¯ä»¥æ²‰æµ¸å…¨å±</div>

  <!-- æ–°å¢ï¼šå‘¼å¸å å±‚ï¼ˆåˆå§‹éšè—ï¼‰ -->
  <div class="breath-overlay" id="breathOverlay" style="display:none;pointer-events:none">
    <div class="breath-circle" id="breathCircle"><div id="breathLabel" style="font-size:14px;color:var(--ink-soft)">å¸æ°”</div></div>
    <div class="breath-controls" style="pointer-events:auto">
      <button id="breathStop" class="ghost">åœæ­¢</button>
    </div>
  </div>
</div>

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
/* â€”â€”â€”â€” åŸºæœ¬ç²’å­ï¼ˆä¿æŒåŸæœ‰çƒŸèŠ±ï¼‰ â€”â€”â€”â€” */
(function(){
  const cvs = document.getElementById('fx');
  const ctx = cvs.getContext('2d');
  let W,H,parts=[];
  function resize(){ W = cvs.width = window.innerWidth * devicePixelRatio; H = cvs.height = window.innerHeight * devicePixelRatio; }
  resize(); window.addEventListener('resize', resize);
  function burst(x,y){ for(let i=0;i<90;i++){ const a=Math.random()*Math.PI*2; const sp=2+Math.random()*5; parts.push({x:x*devicePixelRatio,y:y*devicePixelRatio,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp-2,life:40+Math.random()*60,hue:200+Math.random()*140}); } }
  function tick(){ ctx.clearRect(0,0,W,H); for(let i=parts.length-1;i>=0;i--){ const p=parts[i]; p.vy+=0.08; p.x+=p.vx; p.y+=p.vy; p.life--; ctx.globalAlpha=Math.max(p.life/100,0); ctx.fillStyle=`hsl(${p.hue},85%,60%)`; ctx.beginPath(); ctx.arc(p.x,p.y,2.2,0,Math.PI*2); ctx.fill(); if(p.life<=0) parts.splice(i,1); } requestAnimationFrame(tick); }
  tick();
  document.getElementById('btnConfetti').addEventListener('click', e=> burst(window.innerWidth*0.5,140));
  window.addEventListener('dblclick', e=> burst(e.clientX, e.clientY));
})();

/* â€”â€”â€”â€” å¿ƒæ„¿æ¸…å•ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ â€”â€”â€”â€” (ä¸åŸé€»è¾‘ä¿æŒä¸€è‡´) */
(function(){
  const listEl=document.getElementById('wishes'), txt=document.getElementById('wishTxt'), add=document.getElementById('wishAdd');
  const KEY='lili_wishes_v1';
  function load(){ try{return JSON.parse(localStorage.getItem(KEY))||[]}catch{ return [] } }
  function save(a){ localStorage.setItem(KEY,JSON.stringify(a)) }
  function render(){ const arr=load(); listEl.innerHTML=''; arr.forEach((w,i)=>{ const row=document.createElement('div'); row.className='wish'+(w.done?' done':''); const left=document.createElement('div'); left.textContent=w.text; const right=document.createElement('div'); right.style.display='flex'; right.style.gap='6px'; const ok=document.createElement('button'); ok.className='ghost'; ok.textContent=w.done?'æ¢å¤':'å®Œæˆ'; const del=document.createElement('button'); del.className='ghost'; del.textContent='åˆ é™¤'; ok.onclick=()=>{ arr[i].done=!arr[i].done; save(arr); render(); ping('âœ… å·²æ›´æ–°') }; del.onclick=()=>{ arr.splice(i,1); save(arr); render(); ping('ğŸ—‘ å·²åˆ é™¤') }; right.append(ok,del); row.append(left,right); listEl.append(row); }); }
  add.addEventListener('click', ()=>{ const v=txt.value.trim(); if(!v) return; const arr=load(); arr.unshift({text:v,done:false}); save(arr); txt.value=''; render(); ping('â­ å·²åŠ å…¥å¿ƒæ„¿'); });
  txt.addEventListener('keydown', e=>{ if(e.key==='Enter') add.click() });
  render();
})();

/* â€”â€”â€”â€” å°å‰¯å®˜äº¤äº’ï¼ˆä¿æŒä¸å˜ï¼‰ â€”â€”â€”â€” */
document.querySelectorAll('[data-cat]').forEach(btn=>btn.addEventListener('click', ()=>{ document.getElementById('catState').textContent = btn.dataset.cat; ping('ğŸ¾ å°å‰¯å®˜çŠ¶æ€æ›´æ–°'); }));

/* â€”â€”â€”â€” æç¤ºè‡ªåŠ¨éšè—ï¼ˆæ–°å¢ï¼‰ â€”â€”â€”â€” */
(function(){
  const hint = document.getElementById('hint');
  let hideTimer = null;
  function hideSoon(){ clearTimeout(hideTimer); hideTimer = setTimeout(()=>{ hint.style.opacity='0'; hint.style.transform='translateY(-6px)'; }, 3800); }
  function immediateHide(){ hint.style.opacity='0'; hint.style.transform='translateY(-6px)'; }
  // åˆæ¬¡è‹¥æ— äº¤äº’ï¼Œè‡ªåŠ¨éšè—
  hideSoon();
  // ç”¨æˆ·æœ‰äº¤äº’æ—¶å†çŸ­æš‚æ˜¾ç¤º
  ['touchstart','mousemove','scroll','keydown','click'].forEach(ev=> window.addEventListener(ev, ()=>{ hint.style.opacity='1'; hint.style.transform='translateY(0)'; hideSoon(); }));
  // å¦‚æœè¿›å…¥ PWAï¼ˆstandaloneï¼‰ï¼Œä¹Ÿéšè—
  if(window.matchMedia('(display-mode: standalone)').matches || navigator.standalone) immediateHide();
})();

/* â€”â€”â€”â€” Apple Touch Icon ä¸Šä¼ å¹¶åŠ¨æ€æ›¿æ¢ï¼ˆæ–°å¢ï¼‰ â€”â€”â€”â€” */
(function(){
  const input = document.getElementById('uploadAppleIcon');
  const link = document.getElementById('appleTouchLink');
  input.addEventListener('change', async ()=> {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=> {
      // è®¾ç½® link href ä¸º data URLï¼ˆæ¼”ç¤ºä¸åç«¯ä¿å­˜ç”¨ï¼‰
      link.href = reader.result;
      ping('ğŸ Apple è§¦æ§å›¾æ ‡å·²æ›´æ–°ï¼ˆå¦‚éœ€çœŸå®ç”Ÿæ•ˆï¼Œè¯·æŠŠè¯¥å›¾ç‰‡å‘½åä¸º apple-touch-icon.png å¹¶æ”¾åœ¨ä»“åº“æ ¹ç›®å½•ï¼‰');
      // è‡ªåŠ¨è§¦å‘ä¸‹è½½ï¼Œæ–¹ä¾¿ä½ æŠŠæ–‡ä»¶ä¿å­˜åˆ°ä»“åº“
      const a = document.createElement('a'); a.href = reader.result; a.download = 'apple-touch-icon.png'; a.style.display='none';
      document.body.appendChild(a); a.click(); a.remove();
    };
    reader.readAsDataURL(file);
  });
})();

/* â€”â€”â€”â€” å‘¼å¸å¼•å¯¼ï¼ˆæ–°å¢ï¼‰ â€”â€”â€”â€” */
(function(){
  const overlay = document.getElementById('breathOverlay');
  const circle = document.getElementById('breathCircle');
  const label = document.getElementById('breathLabel');
  const btn = document.getElementById('btnBreath');
  const stop = document.getElementById('breathStop');
  const KEY = 'lili_breathing_mode_v1';
  let running=false, timer=null, phase=0; // 0 inhale,1 hold,2 exhale
  // é»˜è®¤èŠ‚å¥ï¼ˆå¯æ‰©å±•ï¼‰ï¼šå¸4sã€æ†‹1sã€å‘¼6s
  const inhale=4000, hold=1000, exhale=6000;
  function renderPhase(p){
    if(p===0){ label.textContent='å¸æ°”'; circle.style.transition='transform '+(inhale/1000)+'s ease-in-out'; circle.style.transform='scale(1.12)'; }
    else if(p===1){ label.textContent='æ†‹ä½'; circle.style.transition='transform '+(hold/1000)+'s linear'; circle.style.transform='scale(1.14)'; }
    else { label.textContent='å‘¼æ°”'; circle.style.transition='transform '+(exhale/1000)+'s ease-in-out'; circle.style.transform='scale(.84)'; }
  }
  function step(){
    if(!running) return;
    phase = (phase+1)%3;
    renderPhase(phase);
    const delay = phase===0?inhale:phase===1?hold:exhale;
    timer = setTimeout(step, delay);
  }
  function start(){
    running=true; overlay.style.display='flex'; overlay.style.pointerEvents='auto'; phase=0; renderPhase(phase); timer = setTimeout(step, inhale);
    btn.textContent='åœæ­¢å‘¼å¸';
    localStorage.setItem(KEY,'1');
  }
  function stopIt(){
    running=false; overlay.style.display='none'; overlay.style.pointerEvents='none'; clearTimeout(timer); btn.textContent='è·Ÿæˆ‘åšå‘¼å¸';
    localStorage.removeItem(KEY);
  }
  btn.addEventListener('click', ()=> {
    if(running) stopIt(); else start();
  });
  stop.addEventListener('click', stopIt);
  // å¦‚æœä¸Šæ¬¡æ˜¯å¼€å¯çŠ¶æ€ï¼Œæ¢å¤
  if(localStorage.getItem(KEY)) start();
})();

/* â€”â€”â€”â€” åƒè¯æ‰“å¡ï¼ˆæ–°å¢ï¼‰ â€”â€”â€”â€” */
(function(){
  const medCard = document.getElementById('medCard');
  const toggle = document.getElementById('btnToggleMed');
  const KEY = 'lili_med_checkin_v1';
  function todayKey(){ const d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate(); }
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'{}') }catch{ return {} } }
  function save(o){ localStorage.setItem(KEY, JSON.stringify(o)) }
  function render(){
    const data = load(); const t = todayKey();
    const morningBtn = document.getElementById('medMorning');
    const eveningBtn = document.getElementById('medEvening');
    const morningTime = document.getElementById('medMorningTime');
    const eveningTime = document.getElementById('medEveningTime');
    const today = data[t]||{};
    if(today.m){ morningBtn.textContent='æ—©ä¸Š å·²æ‰“å¡'; morningTime.textContent = today.m; } else { morningBtn.textContent='æ—©ä¸Š æ‰“å¡'; morningTime.textContent='æœªæ‰“å¡' }
    if(today.e){ eveningBtn.textContent='æ™šä¸Š å·²æ‰“å¡'; eveningTime.textContent = today.e; } else { eveningBtn.textContent='æ™šä¸Š æ‰“å¡'; eveningTime.textContent='æœªæ‰“å¡' }
  }
  toggle.addEventListener('click', ()=> { medCard.style.display = medCard.style.display==='none'?'block':'none'; });
  document.getElementById('medMorning').addEventListener('click', ()=>{
    const d=new Date(); const now = d.toLocaleTimeString(); const k=todayKey(); const obj=load(); obj[k]=obj[k]||{}; obj[k].m=now; save(obj); render(); ping('ğŸ’Š æ—©ä¸Šå·²æ‰“å¡');
  });
  document.getElementById('medEvening').addEventListener('click', ()=>{
    const d=new Date(); const now = d.toLocaleTimeString(); const k=todayKey(); const obj=load(); obj[k]=obj[k]||{}; obj[k].e=now; save(obj); render(); ping('ğŸ’Š æ™šä¸Šå·²æ‰“å¡');
  });
  document.getElementById('medClear').addEventListener('click', ()=>{
    const obj=load(); delete obj[todayKey()]; save(obj); render(); ping('ğŸ§¼ ä»Šæ—¥æ‰“å¡å·²é‡ç½®');
  });
  // æ¸²æŸ“åˆæ¬¡çŠ¶æ€
  render();
})();

/* â€”â€”â€”â€” ç®€æ˜“æç¤ºå‡½æ•° â€”â€”â€”â€” */
function ping(text){
  const n=document.createElement('div'); n.textContent=text;
  Object.assign(n.style,{position:'fixed',left:'50%',bottom:'calc(env(safe-area-inset-bottom) + 110px)',transform:'translateX(-50%)',padding:'10px 14px',borderRadius:'14px',color:'var(--ink)',background:'rgba(255,255,255,.10)',border:'1px solid rgba(255,255,255,.18)',backdropFilter:'blur(12px)',zIndex:999});
  document.body.appendChild(n); setTimeout(()=>{ n.style.transition='all .4s ease'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(10px)'; },1600); setTimeout(()=>n.remove(),2200);
}

/* â€”â€”â€”â€” è¯´æ˜ï¼šæˆ‘æ²¡æœ‰æ”¹åŠ¨å…¶ä»– UI æ–‡æ¡ˆæˆ–å¸ƒå±€â€”â€”ç»“æŸ â€”â€”â€”â€” */
</script>
</body>
</html>
