<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<!-- é˜²æ­¢ç¼©æ”¾ã€PWA/å…¨å±å¢å¼º -->
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#0d0f14" />
<title>ç»™ç‹¸ç‹¸çš„è¿Ÿåˆ°ç”Ÿæ—¥ç¤¼ç‰© Â· å¤ä»¥æ˜¼</title>

<!-- Apple touch iconï¼šæŠŠ apple-touch-icon.png æ”¾åˆ°åŒç›®å½•æˆ–æ”¹ä¸ºä½ è‡ªå·± URL -->
<link rel="apple-touch-icon" href="./apple-touch-icon.png">

<style>
:root{
  --bg-image: url('wallpaper.jpg'); /* å¯æ›¿æ¢ä¸ºä½ çš„å£çº¸æ–‡ä»¶ */
  --bg-color: #0d0f14;
  --ink: #e9edf8;
  --ink-soft: #b9c1d8;
  --accent: #8ab4ff;
  --glass: rgba(255,255,255,.06);
  --blur: 18px;
  --radius: 18px;
  --dock-height: 84px;
}

/* é‡ç½® & å…³é”®å…¼å®¹ */
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent; -webkit-user-select:none; user-select:none}
html,body{height:100%; margin:0; background:var(--bg-color); font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC",Roboto,Arial,sans-serif; color:var(--ink)}
body{
  /* èƒŒæ™¯å…¨å±å¡«å……ï¼Œå…¼å®¹ Safari çš„ safe-area å’Œ 100svh */
  background-image: var(--bg-image);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  min-height: 100svh;
  min-height: -webkit-fill-available; /* Safari æ”¯æŒ */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  touch-action: manipulation; /* å‡å°‘è¯¯è§¦ç¼©æ”¾/æ‹–æ‹½ */
  -webkit-overflow-scrolling:touch;
}

/* é¡µé¢ä¸»å®¹å™¨ï¼šåœ¨æ¡Œé¢å¤§å°é™åˆ¶ä¸ºâ€œæ‰‹æœºâ€çª—å£ï¼Œæ›´åƒå°åº”ç”¨ */
#app {
  width:100%;
  max-width:420px;
  margin: 0 auto;
  height: calc(100svh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  min-height: -webkit-fill-available;
  display:flex; flex-direction:column;
  position:relative;
}

/* é¡¶æ  */
.header{
  display:flex; gap:12px; align-items:center; padding:12px;
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
  border-bottom: 1px solid rgba(255,255,255,.04);
  backdrop-filter: blur(6px);
}
.avatar{ width:40px; height:40px; border-radius:10px; background:rgba(255,255,255,.06); display:grid; place-items:center; font-size:20px }
.title b{ font-size:16px }
.title small{ color:var(--ink-soft); font-size:12px }

/* å†…å®¹æ»šåŠ¨åŒº */
.content{
  flex:1; overflow:auto; padding:14px; -webkit-overflow-scrolling:touch;
}

/* å¡ç‰‡æ ·å¼ */
.card{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border-radius:16px; padding:12px; margin-bottom:12px; border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 30px rgba(0,0,0,.35); }

/* æ¶ˆæ¯æ°”æ³¡ */
.msg{ max-width:78%; padding:10px 12px; border-radius:14px; margin:8px 0; line-height:1.3 }
.msg.me{ margin-left:auto; background:linear-gradient(180deg, rgba(138,180,255,.85), rgba(138,180,255,.4)); color:#071226 }
.msg.u{ background: rgba(255,255,255,.06); color:var(--ink) }

/* Dockï¼ˆåº•æ ï¼‰ */
.dock{
  position: sticky; bottom: 0; display:flex; gap:14px; align-items:center; justify-content:space-around;
  padding:10px; background:linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.28));
  backdrop-filter: blur(12px);
}
.dock .ico{ width:56px; height:56px; border-radius:14px; display:grid; place-items:center; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); font-size:22px; user-select:none; cursor:pointer }
.dock .ico.active{ outline:2px solid rgba(138,180,255,.5) }

/* å°æç¤ºè‡ªåŠ¨éšè— */
.hint{
  position:fixed; right:12px; top: calc(env(safe-area-inset-top) + 12px); padding:8px 12px; border-radius:12px;
  background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); color:var(--ink-soft); font-size:13px;
  transition: opacity .28s;
}

/* å‘¼å¸ç»ƒä¹ å¼¹çª— */
#breathModal{
  position: fixed; inset: 0; display:none; align-items:center; justify-content:center; z-index:9999;
  background: linear-gradient(0deg, rgba(2,6,10,.45), rgba(2,6,10,.35));
}
.breathBox{ width:260px; height:260px; border-radius:50%; display:grid; place-items:center; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06); backdrop-filter: blur(8px) }
.breathCircle{ width:140px; height:140px; border-radius:50%; background: radial-gradient(circle at 30% 30%, rgba(138,180,255,.6), rgba(181,140,255,.45)); display:grid; place-items:center; color:#071226; font-weight:700; font-size:18px; transform-origin:center; transition: transform 1s cubic-bezier(.2,.9,.2,1) }

/* è¯ç‰©æ‰“å¡æ ·å¼ */
.medRow{ display:flex; gap:8px; align-items:center; justify-content:space-between }
.medBtns{ display:flex; gap:8px }
.medBtns button{ padding:8px 10px; border-radius:10px; border:none; background:linear-gradient(180deg,#d6e2ff,#9ec0ff); color:#071226; cursor:pointer }

/* å°å±å¹•å®‰å…¨åŒºå¡«å……ä¿®å¤ï¼ˆé¿å…ç™½æ¡ï¼‰ */
html,body, #app{ background-color:var(--bg-color); }

/* ç¡®ä¿ canvas / å…¶å®ƒè¦†ç›–å…ƒç´ ä¸é˜»æŒ¡äº¤äº’ */
canvas, #fx { position: fixed; inset: 0; pointer-events: none; z-index:0; }

/* å“åº”å¼ï¼šæ¡Œé¢ä¸Šå±…ä¸­æ˜¾ç¤ºâ€œæ‰‹æœºâ€ */
@media (min-width:740px){
  body{ display:flex; align-items:center; justify-content:center }
  #app{ box-shadow: 0 40px 100px rgba(0,0,0,.6); border-radius:24px; overflow:hidden; height:880px }
}

/* ç‚¹å‡»æ•ˆæœå°åŠ¨ç”» */
.pulse{ animation: pop .22s ease }
@keyframes pop { 0%{ transform: scale(.96); opacity:.95 } 60%{ transform: scale(1.02) } 100%{ transform: scale(1) } }
</style>
</head>
<body>
  <div id="app" role="application" aria-label="ç”Ÿæ—¥å°åº”ç”¨">
    <div class="header">
      <div class="avatar">ğŸ¾</div>
      <div class="title"><b>ç»™ç‹¸ç‹¸çš„ç¤¼ç‰©</b><small>æ‰§èˆ°é¹…åœ¨çº¿ Â· å·²éƒ¨ç½²</small></div>
    </div>

    <div class="content" id="content">
      <div class="card">
        <h2 style="margin:0 0 6px">ç”Ÿæ—¥å¿«ä¹ï¼Œç‹¸ç‹¸</h2>
        <p style="margin:0;color:var(--ink-soft)">è½»è§¦çƒŸèŠ±ï¼Œåˆ‡æ¢æ‰§èˆ°é¹…æ¨¡å¼ï¼Œæˆ–è€…è®©éº»è–¯æŠ¥å‘Šä»Šå¤©çš„å·¡é€»ã€‚</p>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="btnConfetti">æ”¾çƒŸèŠ±</button>
          <button id="btnMode" class="pulse">æ‰§èˆ°é¹…æ¨¡å¼</button>
          <button id="btnPing">å–µçˆªæé†’</button>
          <button id="btnBreath">è·Ÿç€æˆ‘åšæ·±å‘¼å¸</button>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">èŠå¤©é¢„è®¾</h3>
        <div class="msg u">å‰¯èˆ°ç‹¸ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚æ‰§èˆ°é¹…ä¼šåœ¨å²—ã€‚</div>
        <div class="msg me">æ”¶åˆ°ï¼è®°å¾—æŒ‰æ—¶æŠ•å–‚è›‹ç³•ï½</div>
        <div class="msg u">å·²æ´¾é€æ‹¥æŠ±ã€‚</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">å¿ƒæ„¿æ¸…å•</h3>
        <div style="display:flex;gap:8px">
          <input id="wishTxt" type="text" placeholder="å†™ä¸‹ä»Šå¤©çš„å°æ„¿æœ›â€¦" style="flex:1;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--ink)">
          <button id="wishAdd">åŠ å…¥</button>
        </div>
        <div id="wishes" style="margin-top:10px"></div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">éº»è–¯è§’</h3>
        <p id="catState" style="margin:0;color:var(--ink-soft)">éº»è–¯ï¼šæ­£åœ¨ç›‘è§†æ²™å‘ã€‚</p>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button data-cat="åƒç½ç½ä¸­" class="catBtn">æŠ•å–‚ç½ç½</button>
          <button data-cat="é˜³å°å·¡é€»" class="catBtn">é˜³å°å·¡é€»</button>
          <button data-cat="æ™’å¤ªé˜³" class="catBtn">æ™’å¤ªé˜³</button>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">åƒè¯ / æ‰“å¡</h3>
        <div class="medRow">
          <div>
            <div style="color:var(--ink-soft);font-size:13px">ä»Šæ—¥æ—© / æ™š æ‰“å¡</div>
            <div id="medTimes" style="margin-top:6px;color:var(--ink)"></div>
          </div>
          <div class="medBtns">
            <button id="btnMedMorning">æ—©ä¸Šæ‰“å¡</button>
            <button id="btnMedEvening">æ™šä¸Šæ‰“å¡</button>
          </div>
        </div>
        <div style="margin-top:10px;color:var(--ink-soft);font-size:13px">å†å²ï¼ˆæœ€è¿‘ 7 æ¡ï¼‰</div>
        <div id="medHistory" style="margin-top:8px;color:var(--ink);font-size:13px;max-height:120px;overflow:auto"></div>
      </div>

    </div>

    <!-- Dockï¼ˆå›¾æ ‡éƒ½è¦å¯ç‚¹å‡»ï¼‰ -->
    <div class="dock" role="navigation" aria-label="dock">
      <div class="ico" id="icoChat" title="èŠå¤©">ğŸ’¬</div>
      <div class="ico" id="icoWish" title="å¿ƒæ„¿">â­</div>
      <div class="ico" id="icoConfetti" title="çƒŸèŠ±">ğŸ†</div>
      <div class="ico" id="icoCat" title="éº»è–¯">ğŸ±</div>
    </div>

  </div>

  <div class="hint" id="hint">å°æŠ€å·§ï¼šæŠŠæ­¤é¡µã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€ï¼Œå¯ä»¥å˜æˆä¸€ä¸ªå°åº”ç”¨å“¦</div>

  <!-- å‘¼å¸ç»ƒä¹  Modal -->
  <div id="breathModal" aria-hidden="true">
    <div class="breathBox" role="dialog" aria-modal="true">
      <div id="breathCircle" class="breathCircle">å¸æ°”</div>
      <div style="position:absolute;bottom:30px;display:flex;gap:8px">
        <button id="breathStart">å¼€å§‹</button>
        <button id="breathStop">å…³é—­</button>
      </div>
    </div>
  </div>

<script>
/* â€”â€” é€šç”¨å°å·¥å…· â€”â€” */
// è‡ªåŠ¨éšè—æç¤ºï¼ˆäº¤äº’åä¹Ÿä¼šéšè—ï¼‰
const hint = document.getElementById('hint');
let hintTimer = setTimeout(()=> hint.style.opacity = '0', 4200);
function hideHintNow(){ hint.style.opacity = '0'; clearTimeout(hintTimer) }
document.addEventListener('click', hideHintNow, {once:false});

/* â€”â€” ç®€æ˜“â€œçƒŸèŠ±â€ç²’å­ï¼ˆcanvas-free ç®€ç‰ˆï¼šé¡µé¢æŠ–åŠ¨ + è§†è§‰åé¦ˆï¼‰ â€”â€” */
function confettiEffect() {
  // è½»éœ‡
  document.body.animate([{transform:'translateY(0)'},{transform:'translateY(4px)'},{transform:'translateY(0)'}],{duration:300});
  // è§†è§‰æç¤º
  const t = document.createElement('div');
  t.textContent = 'ğŸ‰ å·²æ”¾çƒŸèŠ±';
  Object.assign(t.style,{position:'fixed',left:'50%',top:'40%',transform:'translateX(-50%)',padding:'10px 14px',borderRadius:'12px',background:'rgba(255,255,255,.08)',border:'1px solid rgba(255,255,255,.12)',zIndex:9999});
  document.body.appendChild(t); setTimeout(()=> t.remove(),1200);
}

/* â€”â€” Dock å›¾æ ‡è¡Œä¸º â€”â€” */
function scrollToTop() { document.getElementById('content').scrollTo({top:0,behavior:'smooth'}); }
document.getElementById('icoChat').addEventListener('click', ()=>{
  scrollToTop(); activateDock('icoChat');
});
document.getElementById('icoWish').addEventListener('click', ()=>{
  // å°†å¿ƒæ„¿å¡æ»šåˆ°è§†å£
  const wishes = document.querySelector('#wishes');
  wishes && wishes.scrollIntoView({behavior:'smooth', block:'center'});
  activateDock('icoWish');
});
document.getElementById('icoConfetti').addEventListener('click', ()=>{
  confettiEffect(); activateDock('icoConfetti');
});
document.getElementById('icoCat').addEventListener('click', ()=>{
  const cat = document.getElementById('catState'); cat && cat.scrollIntoView({behavior:'smooth', block:'center'}); activateDock('icoCat');
});
function activateDock(id){
  document.querySelectorAll('.dock .ico').forEach(i=> i.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* â€”â€” é¡µé¢äº¤äº’ç»‘å®š â€”â€” */
document.getElementById('btnConfetti').addEventListener('click', ()=> { confettiEffect(); });
document.getElementById('btnMode').addEventListener('click', ()=>{
  // åˆ‡æ¢è§†è§‰ä¸»é¢˜ï¼ˆç®€å•ç¤ºä¾‹ï¼‰
  document.documentElement.style.setProperty('--bg-color', '#071029');
  confettiEffect(); ping('æ‰§èˆ°é¹…æ¨¡å¼å·²å¯ç”¨');
});
document.getElementById('btnPing').addEventListener('click', ()=> { ping('ğŸ¾ å–µçˆªå·²å‘å‡ºï¼šè®°å¾—åƒé¥­'); });

/* éº»è–¯æŒ‰é’® */
document.querySelectorAll('.catBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const s = btn.getAttribute('data-cat');
    document.getElementById('catState').textContent = 'éº»è–¯ï¼š' + s;
    ping('ğŸ± éº»è–¯çŠ¶æ€æ›´æ–°');
  });
});

/* å¿ƒæ„¿æ¸…å•ï¼ˆlocalStorageï¼‰ */
const WKEY = 'lili_wishes_v2';
function loadWishes(){ try{ return JSON.parse(localStorage.getItem(WKEY)) || [] }catch(e){return []} }
function saveWishes(a){ localStorage.setItem(WKEY, JSON.stringify(a)) }
function renderWishes(){
  const list = loadWishes(); const root = document.getElementById('wishes'); root.innerHTML = '';
  list.forEach((w,i)=>{
    const div = document.createElement('div'); div.className='wish'; div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center';
    const left = document.createElement('div'); left.textContent = w.text; left.style.flex='1';
    const right = document.createElement('div'); right.style.display='flex'; right.style.gap='6px';
    const ok = document.createElement('button'); ok.textContent = w.done ? 'æ¢å¤' : 'å®Œæˆ';
    const del = document.createElement('button'); del.textContent = 'åˆ é™¤';
    ok.onclick = ()=> { list[i].done = !list[i].done; saveWishes(list); renderWishes(); ping('å·²æ›´æ–°å¿ƒæ„¿'); };
    del.onclick = ()=> { list.splice(i,1); saveWishes(list); renderWishes(); ping('å·²åˆ é™¤'); };
    right.appendChild(ok); right.appendChild(del);
    div.appendChild(left); div.appendChild(right); root.appendChild(div);
  });
}
document.getElementById('wishAdd').addEventListener('click', ()=>{
  const v = document.getElementById('wishTxt').value.trim(); if(!v) return; const arr = loadWishes(); arr.unshift({text:v,done:false}); saveWishes(arr); document.getElementById('wishTxt').value=''; renderWishes(); ping('å¿ƒæ„¿å·²åŠ å…¥');
});
renderWishes();

/* â€”â€” å‘¼å¸ç»ƒä¹ å®ç° â€”â€” */
const breathModal = document.getElementById('breathModal');
const breathCircle = document.getElementById('breathCircle');
let breathTimer = null;
let breathPhase = 0; // 0: idle, 1: in progress
function breathStep(){
  // 4s å¸æ°”ï¼Œ 2s å±æ¯ï¼Œ 4s å‘¼æ°” -> å¾ªç¯ 10s
  const phases = [
    {text:'å¸æ°”', scale:1.25, dur:4000},
    {text:'å±æ¯', scale:1.35, dur:2000},
    {text:'å‘¼æ°”', scale:0.75, dur:4000}
  ];
  let idx = 0;
  function loop(){
    const p = phases[idx];
    breathCircle.textContent = p.text;
    breathCircle.style.transform = `scale(${p.scale})`;
    idx = (idx+1) % phases.length;
    breathTimer = setTimeout(loop, p.dur);
  }
  loop();
}
document.getElementById('btnBreath').addEventListener('click', ()=>{
  breathModal.style.display = 'flex'; breathModal.setAttribute('aria-hidden','false'); breathPhase = 1; breathStep();
});
document.getElementById('breathStart').addEventListener('click', ()=>{
  if(breathPhase===0){ breathPhase=1; breathStep(); }
});
document.getElementById('breathStop').addEventListener('click', ()=>{
  breathModal.style.display = 'none'; breathModal.setAttribute('aria-hidden','true'); breathPhase=0; clearTimeout(breathTimer); breathCircle.style.transform='scale(1)'; breathCircle.textContent='å¸æ°”';
});

/* â€”â€” åƒè¯ / æ‰“å¡ï¼ˆæ—©/æ™šï¼‰ â€”â€” */
const MKEY = 'lili_med_v1';
function loadMed(){ try{ return JSON.parse(localStorage.getItem(MKEY)) || [] }catch(e){return []} }
function saveMed(arr){ localStorage.setItem(MKEY, JSON.stringify(arr)) }
function renderMed(){
  const arr = loadMed();
  // å½“å¤©æ—©æ™šæ˜¾ç¤ºï¼ˆä»¥ yyyy-mm-dd åˆ¤æ–­ï¼‰
  const today = new Date().toISOString().slice(0,10);
  const morning = arr.find(it => it.type==='morning' && it.day===today);
  const evening = arr.find(it => it.type==='evening' && it.day===today);
  document.getElementById('medTimes').innerHTML = `æ—©ï¼š${morning? morning.time : 'æœªæ‰“å¡'} <br>æ™šï¼š${evening? evening.time : 'æœªæ‰“å¡'}`;
  // å†å²ï¼ˆæœ€è¿‘7æ¡ï¼‰
  const hist = arr.slice(-7).reverse().map(it => `${it.day} ${it.time} Â· ${it.type}`).join('<br>');
  document.getElementById('medHistory').innerHTML = hist || 'æš‚æ— è®°å½•';
}
function addMed(type){
  const arr = loadMed();
  const now = new Date();
  const day = now.toISOString().slice(0,10);
  const time = now.toTimeString().slice(0,8);
  arr.push({day,time,type});
  saveMed(arr); renderMed(); ping('æ‰“å¡å·²è®°å½•');
}
document.getElementById('btnMedMorning').addEventListener('click', ()=> addMed('morning'));
document.getElementById('btnMedEvening').addEventListener('click', ()=> addMed('evening'));
renderMed();

/* â€”â€” å°æç¤º / Ping â€”â€” */
function ping(text){
  const el = document.createElement('div'); el.textContent = text;
  Object.assign(el.style,{position:'fixed',left:'50%',bottom:'120px',transform:'translateX(-50%)',padding:'10px 14px',borderRadius:'12px',background:'rgba(255,255,255,.06)',border:'1px solid rgba(255,255,255,.08)',zIndex:9999});
  document.body.appendChild(el); setTimeout(()=> { el.style.transition='all .4s'; el.style.opacity='0'; el.style.transform='translateX(-50%) translateY(8px)'; }, 1100);
  setTimeout(()=> el.remove(),1600);
}

/* â€”â€” äº¤äº’å®¹é”™ï¼šé˜»æ­¢æ„å¤–ç¼©æ”¾ï¼ˆå·²è®¾ç½® metaï¼‰ï¼Œå†å¢åŠ æ‰‹åŠ¿çº¦æŸ â€”â€” */
(function(){
  // ç¦æ­¢åŒæŒ‡ç¼©æ”¾ï¼ˆiOS ä¸Šä¸ä¸€å®šå®Œå…¨ç”Ÿæ•ˆï¼Œä½†åŠ ä¸Š touch-action ä¹Ÿèƒ½é™ä½è¯¯è§¦ï¼‰
  let lastTouchEnd = 0;
  document.addEventListener('touchstart', function(e){
    if(e.touches.length>1){ e.preventDefault(); }
  }, {passive:false});
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if (now - lastTouchEnd <= 300){ e.preventDefault(); }
    lastTouchEnd = now;
  }, {passive:false});
})();

/* â€”â€” è‡ªåŠ¨éšè—æç¤ºï¼ˆäº¤äº’åï¼‰ â€”â€” */
document.addEventListener('scroll', ()=> { hint.style.opacity='0' });

/* â€”â€” é¡µé¢åˆå§‹åŒ–å°åŠ¨ä½œ â€”â€” */
(function init(){
  // å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰å£çº¸ï¼Œä¿æŒ CSS å˜é‡ï¼›å¦åˆ™å¯ä»¥é€šè¿‡ JS åŠ¨æ€è®¾ç½® --bg-image
  // æ¿€æ´»é»˜è®¤ Dock ç¬¬ä¸€ä¸ª
  activateDock('icoChat');
})();
</script>
</body>
</html>
