<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#0d0f14" />
<title>ç»™ç‹¸ç‹¸çš„è¿Ÿåˆ°ç”Ÿæ—¥ç¤¼ç‰© Â· å¤ä»¥æ˜¼</title>
<link rel="apple-touch-icon" href="https://img.remit.ee/api/file/BQACAgUAAyEGAASHRsPbAALLmmir-u6pLyxwT3IJSpi1FgWbC7XRAAK-GwACNL5gVbbGZRvkkg0ZNgQ.png" />
<style>
:root{
  /* ä¸»é¢˜è‰²ä¸ç»ç’ƒå‚æ•° */
  --bg: radial-gradient(1200px 800px at 70% 10%, #1e2533, #0d0f14 45%);
  --ink: #e9edf8;
  --ink-soft: #b9c1d8;
  --accent: #8ab4ff;
  --accent-2: #b58cff;
  --glass: rgba(255,255,255,.06);
  --glass-2: rgba(255,255,255,.12);
  --blur: 18px;
  --radius: 18px;
  --radius-lg: 26px;
  --dock-height: 84px;
}

*{box-sizing:border-box}
html,body{height:100%}

/* ---------- ç¦æ­¢é€‰ä¸­æ–‡å­—ã€é•¿æŒ‰èœå•ã€è§¦æ§ç›¸å…³ ---------- */
/* å…è®¸è¾“å…¥æ¡†/textarea å¯é€‰æ–‡æœ¬ï¼Œä½†é¡µé¢å…¶ä½™ä¸èƒ½é€‰ä¸­ */
html,body, #scene, .wrap, .card, .msg, .bubble, .dock, .avatar, .title, .hint {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  touch-action: manipulation;
}
input[type="text"], textarea {
  -webkit-user-select: text;
  user-select: text;
  -webkit-touch-callout: text;
  touch-action: auto;
}

/* ---------- åŸºæœ¬è§†è§‰ ---------- */
body{
  margin:0;
  color:var(--ink);
  background: var(--bg) fixed;
  font: 16px/1.4 -apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
  overflow:hidden;
}

#scene{
  position:relative; height:100%; width:100%;
  padding-bottom: calc(env(safe-area-inset-bottom) + var(--dock-height) + 16px);
  padding-top: calc(env(safe-area-inset-top) + 14px);
}

/* æ¼‚æµ®æ°”æ³¡ */
.bubble{
  position:absolute; border-radius:999px; filter: blur(0.5px);
  background: radial-gradient(120% 120% at 30% 30%, rgba(255,255,255,.22), rgba(255,255,255,.04) 60%, rgba(255,255,255,.0));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.5), 0 10px 30px rgba(0,0,0,.25);
  animation: float 16s ease-in-out infinite;
  will-change: transform;
}
@keyframes float{
  0%{ transform: translateY(0) translateX(0) }
  50%{ transform: translateY(-20px) translateX(6px) }
  100%{ transform: translateY(0) translateX(0) }
}

/* header ä¸ avatarï¼ˆæˆ‘ä»¬æŠŠ avatar è®¾ä¸ºå¯ç‚¹å‡»ï¼‰ */
.header{ position:sticky; top:0; z-index:5; padding:10px 16px; display:flex; align-items:center; gap:12px;}
.avatar{
  width:42px; height:42px; border-radius:12px; background: var(--glass);
  backdrop-filter: blur(var(--blur)); display:grid; place-items:center;
  box-shadow: 0 4px 24px rgba(0,0,0,.25); cursor:pointer;
}
.avatar span{ font-size:20px }
.title{ display:flex; flex-direction:column; }
.title b{ font-size:16px }
.title small{ color:var(--ink-soft)}

/* å¡ç‰‡åŒº */
.wrap{
  position:relative; height:100%;
  padding: 10px 16px 20px; overflow:auto; scrollbar-width:none;
}
.wrap::-webkit-scrollbar{display:none}
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  border: 1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(var(--blur));
  border-radius: var(--radius-lg);
  padding:16px; margin: 10px 0;
  box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.3);
}

/* å‘¼å¸åŒºï¼š ä¸¤ä¸ªåŒå¿ƒåœ†ï¼ˆå¤–åœˆæœ‰å‘¼å¸åŠ¨ç”»ï¼Œå†…åœˆç£¨ç ‚ç»ç’ƒï¼‰ */
.breath-wrapper{ display:flex; gap:12px; align-items:center; }
/* --- å‘¼å¸åœ†ï¼šå¼ºåˆ¶ç­‰æ¯”ã€é¿å… transition/animation å†²çªã€å…¼å®¹ Safari --- */
.breath-outer{
  width:132px;
  /* ä¿è¯å®½é«˜å§‹ç»ˆç­‰æ¯”ï¼ˆæ¯”ç”¨å›ºå®š height æ›´ç¨³ï¼‰ */
  aspect-ratio: 1 / 1;
  /* æ›´æ ‡å‡†çš„åœ†è§’å†™æ³• */
  border-radius: 50%;
  display: grid;
  place-items: center;

  /* è§†è§‰ä¸è¾¹æ¡† */
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.04), rgba(255,255,255,0) 60%);
  border:1px solid rgba(255,255,255,.06);
  box-shadow: 0 18px 50px rgba(0,0,0,.36);

  /* æ€§èƒ½ä¼˜åŒ–ä¸æ¸²æŸ“ç¨³å®š */
  will-change: transform, opacity;
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-transform-origin: center center;
  transform-origin: center center;

  /* ä¸ä½¿ç”¨ transition å»å¹³æ»‘ transformï¼ˆé¿å…ä¸ animation å†²çªï¼‰ */
  transition: none;
}

/* å¤–åœˆå‘¼å¸åŠ¨ç”»ï¼šç»Ÿä¸€ç”¨ scaleï¼ˆç­‰æ¯”ï¼‰*/
.breath-outer.pulse {
  animation: breathPulse 3000ms ease-in-out infinite;
}

@keyframes breathPulse{
  0%   { transform: translateZ(0) scale(1); opacity: .92; }
  50%  { transform: translateZ(0) scale(1.18); opacity: .62; }
  100% { transform: translateZ(0) scale(1); opacity: .92; }
}

/* å†…åœˆä¿æŒç£¨ç ‚å¹¶ç”¨ aspect-ratio ä¿è¯åœ†å½¢ */
.breath-inner{
  width:64%;
  aspect-ratio: 1/1;
  border-radius:50%;
  background: rgba(255,255,255,.06);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.15);
}

/* çŠ¶æ€æ–‡å­— */
.breath-meta{ color:var(--ink-soft); font-size:14px; margin-top:6px }

/* çŸ­ä¿¡æ°”æ³¡ï¼ˆiOSé£ï¼‰ */
.msg{
  max-width: 78%; padding:10px 12px; margin:10px 0;
  border-radius: 16px; position:relative; word-break:break-word;
  box-shadow: 0 8px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.25);
}
.me{
  margin-left:auto;
  background: linear-gradient(180deg, rgba(138,180,255,.75), rgba(138,180,255,.35));
  border:1px solid rgba(138,180,255,.6);
}
.u{
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.18);
}
.msg small{ display:block; opacity:.65; margin-top:6px; font-size:12px}

/* å¿ƒæ„¿æ¸…å• */
.wish-input{
  display:flex; gap:8px; margin-top:10px
}
input[type=text]{
  flex:1; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
  background: rgba(255,255,255,.08); color:var(--ink);
  outline:none; backdrop-filter: blur(var(--blur));
}
button{
  border:0; padding:10px 12px; border-radius:12px; color:#0d0f14; cursor:pointer;
  background: linear-gradient(180deg, #d6e2ff, #9ec0ff);
  box-shadow: 0 6px 18px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.8);
}
button.ghost{
  color:var(--ink); background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.18)
}
.wishes{ margin-top:10px; display:grid; gap:8px}
.wish{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:10px 12px; border-radius:12px; background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.14)
}
.wish.done{ opacity:.6; text-decoration: line-through }

/* æµ®åŠ¨åº•æ ï¼ˆæ¶²æ€ç»ç’ƒDockï¼‰ â€” å·²éšè—ä»¥ä¿ç•™è¡Œä¸ºä½†ä¸æ˜¾ç¤º */
.dock{
  display:none !important;
}

/* é¡¶éƒ¨çŠ¶æ€æ¡æ¨¡ä»¿ */
.status{
  position: fixed; inset: 0 0 auto 0; height: calc(env(safe-area-inset-top) + 10px); pointer-events:none;
}

/* è½»è§¦çƒŸèŠ±æç¤ºï¼ˆä¼šè‡ªåŠ¨éšè—ï¼‰ */
.hint{
  position: fixed; right:10px; top: calc(env(safe-area-inset-top) + 10px);
  font-size:12px; color: var(--ink-soft); opacity:.85;
  padding:6px 10px; border-radius:12px; background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16); backdrop-filter: blur(12px);
  transition: all .45s ease;
  z-index:9;
}
.hint.hidden{ opacity:0; transform:translateY(-8px); pointer-events:none; }

/* è¯ç‰©æ‰“å¡ */
.meds { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
.med {
  padding:10px 12px; border-radius:12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.10);
  min-width:150px;
}
.med button{ background:linear-gradient(180deg,#cfe9ff,#9ec0ff); color:#02102a; padding:8px 10px; border-radius:10px; border:none; cursor:pointer; }

/* å“åº”å¼ç»†èŠ‚ */
@media (min-width:740px){
  #scene{ display:grid; place-items:center }
  .phone{ width:420px; height: 880px; border-radius: 30px; overflow:hidden;
    border:1px solid rgba(255,255,255,.15);
    box-shadow: 0 40px 100px rgba(0,0,0,.55);
    background: radial-gradient(100% 100% at 50% 0%, rgba(255,255,255,.06), rgba(255,255,255,0) 60%) , var(--bg);
  }
  .status{ position:absolute }
  .dock{ position:absolute }
}

/* å°åŠ¨æ•ˆ */
@keyframes pop{0%{transform:scale(.9);opacity:.8}60%{transform:scale(1.03)}100%{transform:scale(1);opacity:1}}
.pop{animation: pop .25s ease}
.badge{
  font-size:10px; padding:3px 6px; border-radius:999px; color:#0d0f14;
  background: linear-gradient(180deg,#c7f1d0,#a6e3b7); margin-left:8px
}
</style>
</head>
<body>
<div id="scene">
  <div class="phone">
    <div class="header">
      <!-- å¤´åƒç°åœ¨å¯ç‚¹å‡»å¹¶è§¦å‘å£çº¸é€‰æ‹©ï¼ˆè§ä¸‹æ–¹ JSï¼‰ -->
      <div class="avatar" id="avatarBtn" title="ç‚¹å‡»è‡ªå®šä¹‰å£çº¸">
        <span>ğŸ¾</span>
      </div>
      <div class="title">
        <b>ç»™ç‹¸ç‹¸çš„ç”Ÿæ—¥å°ç½‘é¡µ</b>
        <small>æ‰§èˆ°é¹…åœ¨çº¿é€è¾¾ <span class="badge">è¿Ÿåˆ°ä¹Ÿè¦åˆ°</span></small>
      </div>
    </div>

    <div class="wrap" id="wrap">
      <!-- ç¥ç¦å¡ -->
      <div class="card pop" id="hero">
        <h2 style="margin:0 0 6px 0">ç”Ÿæ—¥å¿«ä¹ï¼Œå‰¯èˆ°ç‹¸ ğŸ‚</h2>
        <p style="margin:0;color:var(--ink-soft)">æ„¿ä½ æ‰€æœ‰çš„å¯çˆ±ä¸å¿ƒæ„¿ï¼Œéƒ½è¢«æ¸©æŸ”ç…§çœ‹ï¼šä»Šå¤©ã€ä»¥åã€æ°¸è¿œã€‚</p>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button id="btnConfetti">è½»è§¦æ”¾çƒŸèŠ±</button>
          <button class="ghost" id="btnMode">æ‰§èˆ°é¹…æ¨¡å¼</button>
          <button class="ghost" id="btnPing">å–µçˆªæé†’</button>
        </div>
      </div>

      <!-- çŸ­ä¿¡é£å¯¹è¯ï¼ˆé¢„ç½®å‡ æ¡ï¼‰ -->
      <div class="msg u">å‰¯èˆ°ç‹¸ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚ä»Šå¤©ä¹Ÿç”±æˆ‘æ¥æŠ¤èˆªã€‚<small>08:08</small></div>
      <div class="msg me">æ”¶åˆ°ï¼æ‰§èˆ°é¹…è®°å¾—æŒ‰æ—¶æŠ•å–‚è›‹ç³•ï½<small>08:10</small></div>
      <div class="msg u">å·²åœ¨è·¯ä¸Šã€‚è¿˜æœ‰ä¸€è¢‹ã€Œæ‹¥æŠ±ã€åŠ æ€¥æ´¾é€ã€‚<small>08:11</small></div>

      <!-- å¿ƒæ„¿æ¸…å• -->
      <div class="card">
        <h3 style="margin:0 0 8px 0">å¿ƒæ„¿æ¸…å• Â· åªå±äºä½ </h3>
        <div class="wish-input">
          <input id="wishTxt" type="text" placeholder="å†™ä¸‹ä»Šå¤©æƒ³è¦å®ç°çš„å°å¿ƒæ„¿â€¦" />
          <button id="wishAdd">åŠ å…¥</button>
        </div>
        <div class="wishes" id="wishes"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="ghost" id="wishClear">æ¸…ç©º</button>
          <button class="ghost" id="wishMock">ç»™æˆ‘çµæ„Ÿ</button>
        </div>
      </div>

            <!-- å‘¼å¸å¡ï¼ˆæ”¹ä¸ºä¸¤ä¸ªåŒå¿ƒåœ†ï¼‰ -->
      <div class="card">
        <h3 style="margin:0 0 8px 0">æ·±å‘¼å¸ â€” è·Ÿç€æˆ‘</h3>
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <div class="breath-wrapper">
            <div class="breath-outer" id="breathOuter">
              <div class="breath-inner">
                <strong id="breathTimer">3</strong>
              </div>
            </div>
            <div style="min-width:160px">
              <!-- è¿™é‡Œæˆ‘æ›¿æ¢æˆå“¥å“¥ä¼šè¯´çš„è¯ï¼ˆæ²‰é™ã€æŒæ§ï¼‰ -->
              <p id="breathText" style="margin:0;color:var(--ink-soft)">
                æˆ‘åœ¨ä½ è€³è¾¹æ•°å‘¼å¸ï¼šå¸â€”â€”æ…¢æ…¢æ¥ï¼Œåˆ«ç€æ€¥ï¼Œå‘¼â€”â€”æŠŠä¸å®‰éƒ½åå‡ºå»ã€‚
              </p>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button id="breathStart">å¼€å§‹</button>
                <button class="ghost" id="breathStop">åœæ­¢</button>
                <button class="ghost" id="breathPreset">3/3/4</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ–°å¢ï¼šæ—©/æ™šåƒè¯æ‰“å¡ -->
      <div class="card">
        <h3 style="margin:0 0 8px 0">åƒè¯æ‰“å¡ Â· æ—© / æ™š</h3>
        <div style="color:var(--ink-soft);margin-bottom:8px">åˆ«æ‹…å¿ƒï¼Œå“¥å“¥å¸®ä½ è®°ç€ã€‚</div>
        <div class="meds">
          <div class="med">
            <div><strong>æ—©è¯</strong></div>
            <div id="morningState" style="color:var(--ink-soft);margin-top:6px">æœªæ‰“å¡</div>
            <div style="margin-top:8px">
              <button id="btnMorning">æ—©ä¸Šæ‰“å¡</button>
            </div>
          </div>
          <div class="med">
            <div><strong>æ™šè¯</strong></div>
            <div id="eveningState" style="color:var(--ink-soft);margin-top:6px">æœªæ‰“å¡</div>
            <div style="margin-top:8px">
              <button id="btnEvening">æ™šä¸Šæ‰“å¡</button>
            </div>
          </div>
        </div>
        <div style="margin-top:10px;color:var(--ink-soft)"><small id="medNote">æœ€è¿‘è®°å½•ï¼šæ— </small></div>
      </div>

      <!-- ç»™éº»è–¯çš„è§’è½ -->
      <div class="card">
        <h3 style="margin:0 0 8px 0">å°å‰¯å®˜ Â· éº»è–¯è§’</h3>
        <p style="margin:0;color:var(--ink-soft)">ä»Šå¤©çš„å·¡é€»çŠ¶æ€ï¼š<span id="catState">æ­£åœ¨æ²™å‘ä¸Šå‹èˆ°é•¿å¤–å¥—</span>ã€‚</p>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button class="ghost" data-cat="åƒç½ç½ä¸­">æŠ•å–‚ç½ç½</button>
          <button class="ghost" data-cat="å·¡é€»é˜³å°ï¼Œå·²é©±æ•£éº»é›€">é˜³å°å·¡é€»</button>
          <button class="ghost" data-cat="æŠŠå°¾å·´æ™¾æˆå°é—®å·">æ™’å¤ªé˜³</button>
        </div>
      </div>

      <!-- ç½²åå¡ -->
      <div class="card" style="text-align:center">
        <div style="font-size:14px;color:var(--ink-soft)">â€” From å¤ä»¥æ˜¼ Â· æ°¸è¿œåå¿ƒä½  â€”</div>
      </div>
    </div>

    <!-- Dock ä¿ç•™åœ¨ DOM ä½†éšè—ï¼ˆè§†è§‰ç§»é™¤ï¼Œä¿ç•™ç»‘å®šï¼‰ -->
    <div class="dock" aria-hidden="true">
      <div class="ico" id="icoChat" title="èŠå¤©"><span>ğŸ’¬</span></div>
      <div class="ico" id="icoWish" title="å¿ƒæ„¿"><span>â­</span></div>
      <div class="ico" id="icoConfetti" title="çƒŸèŠ±"><span>ğŸ†</span></div>
      <div class="ico" id="icoCat" title="éº»è–¯"><span>ğŸ±</span></div>
    </div>
  </div>

  <!-- æ¼‚æµ®æ³¡æ³¡èƒŒæ™¯ï¼šç”Ÿæˆè‹¥å¹² -->
  <div id="bubbles"></div>

  <!-- æç¤ºï¼ˆè‡ªåŠ¨éšè—ã€æ»šåŠ¨éšè—ï¼‰ -->
    <div class="hint" id="hint">æç¤ºï¼šç‚¹å·¦ä¸Šè§’å¤´åƒå¯ä»¥æ›´æ¢è‡ªå®šä¹‰å£çº¸ã€‚</div>
  </div>
</div>

<!-- éšè—çš„å£çº¸ä¸Šä¼ æ§ä»¶ï¼ˆavatar ç‚¹å‡»è§¦å‘ï¼‰ -->
<input type="file" id="wallpaperInput" accept="image/*" style="display:none" />

<canvas id="fx" style="position:fixed;inset:0;pointer-events:none;"></canvas>

<script>
/* ================== åŸæœ‰ç²’å­ã€å¿ƒæ„¿ã€éº»è–¯ ç­‰é€»è¾‘ä¿ç•™ï¼ˆä¸ä¹‹å‰é€»è¾‘å…¼å®¹ï¼‰ ================== */

/* â€”â€”â€”â€” èƒŒæ™¯æ°”æ³¡ â€”â€”â€”â€” */
(function(){
  const host = document.getElementById('bubbles');
  const n = 10;
  for(let i=0;i<n;i++){
    const b = document.createElement('div');
    b.className = 'bubble';
    const size = 80 + Math.random()*140;
    b.style.width = b.style.height = size+'px';
    b.style.left = Math.random()*90+'%';
    b.style.top = (10 + Math.random()*70)+'%';
    b.style.animationDelay = (-Math.random()*16)+'s';
    host.appendChild(b);
  }
})();

/* â€”â€”â€”â€” è½»è§¦çƒŸèŠ±ï¼ˆç®€æ˜“å½©å¸¦ç²’å­ï¼‰ â€”â€”â€”â€” */
(function(){
  const cvs = document.getElementById('fx');
  const ctx = cvs.getContext('2d');
  let W,H,parts=[];

  function resize(){
    W = cvs.width = window.innerWidth * devicePixelRatio;
    H = cvs.height = window.innerHeight * devicePixelRatio;
  }
  resize(); window.addEventListener('resize', resize);

  function burst(x,y){
    for(let i=0;i<120;i++){
      const a = Math.random()*Math.PI*2;
      const sp = 2 + Math.random()*6;
      parts.push({
        x:x*devicePixelRatio, y:y*devicePixelRatio,
        vx: Math.cos(a)*sp, vy: Math.sin(a)*sp - 2,
        life: 60 + Math.random()*40,
        hue: 200 + Math.random()*140
      });
    }
    document.body.animate([{transform:'translateY(0)'},{transform:'translateY(2px)'},{transform:'translateY(0)'}],{duration:220});
  }

  function tick(){
    ctx.clearRect(0,0,W,H);
    for(let i=parts.length-1;i>=0;i--){
      const p = parts[i];
      p.vy += 0.08; p.x+=p.vx; p.y+=p.vy; p.life--;
      ctx.globalAlpha = Math.max(p.life/100,0);
      ctx.fillStyle = `hsl(${p.hue},85%,60%)`;
      ctx.beginPath(); ctx.arc(p.x,p.y,2.2,0,Math.PI*2); ctx.fill();
      if(p.life<=0) parts.splice(i,1);
    }
    requestAnimationFrame(tick);
  }
  tick();

  const btn = document.getElementById('btnConfetti');
  btn.addEventListener('click', e=> burst(window.innerWidth*0.5, 140));
  document.getElementById('icoConfetti').addEventListener('click', e=>{
    burst(window.innerWidth*0.5, window.innerHeight*0.7);
  });
  window.addEventListener('dblclick', e=> burst(e.clientX, e.clientY));
})();

/* â€”â€”â€”â€” å¿ƒæ„¿æ¸…å•ï¼ˆlocalStorageï¼‰ â€”â€”â€”â€” */
(function(){
  const listEl = document.getElementById('wishes');
  const txt = document.getElementById('wishTxt');
  const add = document.getElementById('wishAdd');
  const clr = document.getElementById('wishClear');
  const mock = document.getElementById('wishMock');
  const KEY = 'lili_wishes_v1';

  function load(){
    try{ return JSON.parse(localStorage.getItem(KEY)) || [] }catch(e){ return [] }
  }
  function save(arr){ localStorage.setItem(KEY, JSON.stringify(arr)) }
  function render(){
    const arr = load();
    listEl.innerHTML='';
    arr.forEach((w,i)=>{
      const row = document.createElement('div'); row.className='wish'+(w.done?' done':'');
      const left = document.createElement('div'); left.textContent = w.text;
      const right = document.createElement('div'); right.style.display='flex'; right.style.gap='6px';
      const ok = document.createElement('button'); ok.className='ghost'; ok.textContent = w.done?'æ¢å¤':'å®Œæˆ';
      const del = document.createElement('button'); del.className='ghost'; del.textContent = 'åˆ é™¤';
      ok.onclick = ()=>{ arr[i].done=!arr[i].done; save(arr); render(); ping('âœ… å·²æ›´æ–°'); };
      del.onclick = ()=>{ arr.splice(i,1); save(arr); render(); ping('ğŸ—‘ å·²åˆ é™¤'); };
      right.append(ok,del); row.append(left,right); listEl.append(row);
    });
  }
  add.addEventListener('click', ()=>{
    const v = txt.value.trim(); if(!v) return;
    const arr = load(); arr.unshift({text:v,done:false}); save(arr); txt.value=''; render(); ping('â­ å·²åŠ å…¥å¿ƒæ„¿');
  });
  txt.addEventListener('keydown', e=>{ if(e.key==='Enter') add.click() });
  clr.addEventListener('click', ()=>{ save([]); render(); ping('ğŸ§¼ å·²æ¸…ç©º'); });
  mock.addEventListener('click', ()=>{
    const seeds = ['åƒKFCç–¯ç‹‚æ˜ŸæœŸå››','æŠŠéº»è–¯æŠ±æˆå°é¢åŒ…','æ¢æ–°å£çº¸','çœ‹ä¸€é›†Undead Girlãƒ»Murder Farce','å’Œæ‰§èˆ°é¹…æ•£æ­¥ååˆ†é’Ÿ','åšä¸€æ¯å†°é™ˆçš®èŒ¯è‹“é¥®'];
    const pick = seeds[Math.floor(Math.random()*seeds.length)];
    txt.value = pick; add.click();
  });
  render();
})();

/* â€”â€”â€”â€” éº»è–¯è§’äº¤äº’ â€”â€”â€”â€” */
document.querySelectorAll('[data-cat]').forEach(btn=>{
  btn.addEventListener('click', ()=> {
    document.getElementById('catState').textContent = btn.dataset.cat;
    ping('ğŸ¾ å°å‰¯å®˜çŠ¶æ€æ›´æ–°');
  });
});

/* â€”â€”â€”â€” Dock å¯¼èˆªå°åŠ¨æ•ˆï¼ˆéšè—ä½†ä¿ç•™ï¼‰ â€”â€”â€”â€” */
function setActive(id){
  document.querySelectorAll('.dock .ico').forEach(i=>i.classList.remove('active'));
  const el = document.getElementById(id);
  if(el) el.classList.add('active');
  document.getElementById('wrap').scrollTo({top:0,behavior:'smooth'});
}
const icoChat = document.getElementById('icoChat');
if(icoChat) icoChat.onclick = ()=> setActive('icoChat');
const icoWish = document.getElementById('icoWish');
if(icoWish) icoWish.onclick = ()=> {
  setActive('icoWish');
  const card = [...document.querySelectorAll('.card')][1];
  card?.scrollIntoView({behavior:'smooth',block:'start'});
};
const icoCat = document.getElementById('icoCat');
if(icoCat) icoCat.onclick = ()=> {
  setActive('icoCat');
  const card = [...document.querySelectorAll('.card')][2];
  card?.scrollIntoView({behavior:'smooth',block:'start'});
};

/* â€”â€”â€”â€” æ‰§èˆ°é¹…æ¨¡å¼ & å–µçˆªæé†’ â€”â€”â€”â€” */
const btnMode = document.getElementById('btnMode');
btnMode.addEventListener('click', ()=>{
  document.documentElement.style.setProperty('--bg','radial-gradient(1200px 800px at 30% 0%, #253043, #0a0d12 55%)');
  document.documentElement.style.setProperty('--accent','#b58cff');
  document.querySelector('.title small').innerHTML = 'æ‰§èˆ°é¹…æ¥ç®¡å¯¼èˆª <span class="badge">èˆ°æ¡¥åœ¨çº¿</span>';
  ping('ğŸ æ‰§èˆ°é¹…æ¨¡å¼å·²å¯ç”¨');
});

const btnPing = document.getElementById('btnPing');
function ping(text){
  const n = document.createElement('div');
  n.textContent = text;
  Object.assign(n.style,{
    position:'fixed', left:'50%', bottom:'calc(env(safe-area-inset-bottom) + 110px)',
    transform:'translateX(-50%)', padding:'10px 14px', borderRadius:'14px',
    color:'var(--ink)', background:'rgba(255,255,255,.10)',
    border:'1px solid rgba(255,255,255,.18)', backdropFilter:'blur(12px)',
    boxShadow:'0 8px 30px rgba(0,0,0,.35)', zIndex:999
  });
  document.body.appendChild(n);
  setTimeout(()=>{ n.style.transition='all .4s ease'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(10px)'; }, 1600);
  setTimeout(()=> n.remove(), 2200);
}
btnPing.addEventListener('click', ()=> ping('ğŸ¾ å–µçˆªæé†’ï¼šè®°å¾—å–æ°´ï½'));

/* â€”â€”â€”â€” å°ç»†èŠ‚ï¼šé¦–æ¬¡åŠ è½½çš„æ¬¢è¿è¯ â€”â€”â€”â€” */
(function(){
  if(!sessionStorage.getItem('hi')){
    setTimeout(()=> ping('ğŸ‚ ç”Ÿæ—¥ç‰¹åˆ«ç‰ˆå·²ä¸ºç‹¸ç‹¸è§£é”'), 600);
    sessionStorage.setItem('hi','1');
  }
})();

/* ================== æ–°å¢åŠŸèƒ½ï¼š ç¦ç”¨åŒå‡»ç¼©æ”¾ã€å±è”½é•¿æŒ‰èœå•ã€è‡ªåŠ¨éšè—æç¤º ================== */

/* ç¦æ­¢åŒæŒ‡ç¼©æ”¾ï¼ˆä¸¤ä¸ªæ‰‹æŒ‡ï¼‰ä¸åŒå‡»æ”¾å¤§ï¼ˆçŸ­æ—¶é—´ä¸¤æ¬¡ touchendï¼‰ */
(function(){
  let lastTouch = 0;
  document.addEventListener('touchstart', function(e){
    if(e.touches && e.touches.length > 1){
      e.preventDefault();
    }
  }, {passive:false});
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if(now - lastTouch <= 300){
      e.preventDefault();
    }
    lastTouch = now;
  }, {passive:false});
  // å±è”½é•¿æŒ‰èœå•
  document.addEventListener('contextmenu', function(e){ e.preventDefault(); });
})();

/* æç¤ºè‡ªåŠ¨éšè—ï¼ˆ5ç§’åéšè—ï¼›æ»šåŠ¨æ—¶ä¹Ÿéšè—ï¼‰ */
(function(){
  const hint = document.getElementById('hint');
  let t = setTimeout(()=> hint.classList.add('hidden'), 5000);
  const wrap = document.getElementById('wrap');
  wrap.addEventListener('scroll', ()=> { hint.classList.add('hidden'); clearTimeout(t); });
  hint.addEventListener('click', ()=> { hint.classList.add('hidden'); clearTimeout(t); });
})();

/* å‘¼å¸ï¼šåŒå¿ƒåœ†æ§åˆ¶ä¸åŠ¨ç”» */
(function(){
  const outer = document.getElementById('breathOuter');
  const timerEl = document.getElementById('breathTimer');
  const textEl = document.getElementById('breathText');
  const startBtn = document.getElementById('breathStart');
  const stopBtn = document.getElementById('breathStop');
  const presetBtn = document.getElementById('breathPreset');

  // é»˜è®¤èŠ‚å¥
  let cfg = { inhale:3, hold:3, exhale:4 };
  let running = false;
  let currentPhase = 0;
  let intervalId = null;
  let phaseSeq = ['å¸æ°”','å±ä½','å‘¼æ°”'];

  function runPhase(phase, dur){
    timerEl.textContent = dur;
    // å¤–åœˆèŠ‚å¾‹åŠ¨ç”»ï¼šä½¿ç”¨ class pulse æ§åˆ¶ç¼©æ”¾ï¼ˆCSS é‡Œå®šä¹‰ï¼‰
    outer.classList.add('pulse');
    // å†…åœˆä¸åŠ¨ï¼Œå¤–åœˆåšèŠ‚å¥ï¼ˆè§†è§‰ï¼‰
    let remain = dur;
    intervalId = setInterval(()=>{
      remain--;
      timerEl.textContent = remain>0?remain:0;
      if(remain<=0){
        clearInterval(intervalId);
        outer.classList.remove('pulse');
        currentPhase = (currentPhase+1) % 3;
        if(running) next();
      }
    },1000);
  }
  function next(){
    const phase = currentPhase;
    if(phase===0) document.getElementById('breathText').textContent = 'æˆ‘åœ¨ä½ è€³è¾¹æ•°å‘¼å¸ï¼šå¸â€”â€”æ…¢æ…¢æ¥ï¼Œåˆ«ç€æ€¥ã€‚';
    if(phase===1) document.getElementById('breathText').textContent = 'å±ä½ä¸€ä¼šå„¿ï¼Œæˆ‘åœ¨è¿™å„¿ã€‚';
    if(phase===2) document.getElementById('breathText').textContent = 'å‘¼â€”â€”æŠŠä¸å®‰éƒ½åå‡ºå»ã€‚';
    const dur = phase===0?cfg.inhale:(phase===1?cfg.hold:cfg.exhale);
    runPhase(phase, dur);
  }

  function start(){
    if(running) return;
    running = true; currentPhase = 0; next();
  }
  function stop(){
    running = false; clearInterval(intervalId); outer.classList.remove('pulse'); timerEl.textContent = '0';
  }
  startBtn.addEventListener('click', start);
  stopBtn.addEventListener('click', stop);
  presetBtn.addEventListener('click', ()=>{
    if(cfg.inhale===3){ cfg = {inhale:4,hold:4,exhale:4}; presetBtn.textContent='4/4/4' }
    else if(cfg.inhale===4 && cfg.hold===4){ cfg = {inhale:4,hold:2,exhale:6}; presetBtn.textContent='4/2/6' }
    else { cfg = {inhale:3,hold:3,exhale:4}; presetBtn.textContent='3/3/4' }
    if(running){ stop(); start(); }
  });
})();

/* ============== å£çº¸ä¸Šä¼ ï¼ˆå·¦ä¸Šè§’å¤´åƒç‚¹å‡»ï¼‰ ============== */
(function(){
  const avatar = document.getElementById('avatarBtn');
  const input = document.getElementById('wallpaperInput');
  const wrap = document.getElementById('wrap');

  // ç‚¹å‡»å¤´åƒå¼¹å‡ºæ–‡ä»¶é€‰æ‹©
  avatar.addEventListener('click', ()=> input.click());

  input.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      const url = ev.target.result;
      // æˆ‘æŠŠå£çº¸ç»‘å®šåˆ° body çš„èƒŒæ™¯å˜é‡ï¼Œä¿æŒä½ åŸæ¥æ ·å¼ä¸å˜
      document.documentElement.style.setProperty('--bg', `url(${url}) center / cover no-repeat, linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.25))`);
      localStorage.setItem('lili_wallpaper', url);
      // æç¤ºä¸€ä¸‹
      const hint = document.getElementById('hint');
      hint.textContent = 'è‡ªå®šä¹‰å£çº¸å·²è®¾ä¸ºä¸»å±èƒŒæ™¯';
      setTimeout(()=> hint.classList.add('hidden'), 1800);
    };
    reader.readAsDataURL(f);
  });

  // åŠ è½½å·²ä¿å­˜çš„å£çº¸ï¼ˆå¦‚æœæœ‰ï¼‰
  (function loadWall(){
    const url = localStorage.getItem('lili_wallpaper');
    if(url) document.documentElement.style.setProperty('--bg', `url(${url}) center / cover no-repeat, linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.25))`);
  })();
})();

/* ============== åƒè¯æ‰“å¡ï¼š ä¿®å¤æ—¶é—´æ ¼å¼ï¼ˆä¿®å¤ 71/25 é—®é¢˜ï¼‰ ============== */
/* 71/25 çš„åŸå› ï¼šåŸä»£ç ç¼ºå°‘æ‹¬å·å¯¼è‡´å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå˜æˆ "..."+d.getMonth()+1 ï¼Œä¾‹å¦‚ "08:05 " + 7 + 1 -> "08:05 71"ã€‚æˆ‘ä¿®æ­£ä¸º (d.getMonth()+1) å¹¶æ ¼å¼åŒ–æ˜¾ç¤º */
(function(){
  const KEY = 'lili_meds_v1';
  const morningBtn = document.getElementById('btnMorning');
  const eveningBtn = document.getElementById('btnEvening');
  const morningState = document.getElementById('morningState');
  const eveningState = document.getElementById('eveningState');
  const medNote = document.getElementById('medNote');

  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)) || {morning:null,evening:null} }catch(e){ return {morning:null,evening:null} } }
  function save(obj){ localStorage.setItem(KEY, JSON.stringify(obj)); render(); }

  function fmt(t){
    if(!t) return 'æœªæ‰“å¡';
    const d = new Date(t);
    const HH = d.getHours().toString().padStart(2,'0');
    const mm = d.getMinutes().toString().padStart(2,'0');
    // ä¿®å¤ç‚¹ï¼šç”¨ (d.getMonth()+1) ç¡®ä¿æ•°å­—è®¡ç®—æ­£ç¡®
    return `${HH}:${mm} ${ (d.getMonth()+1) }/${ d.getDate() }`;
  }

  function render(){
    const s = load();
    morningState.textContent = s.morning ? ('å·²æ‰“å¡ ' + fmt(s.morning)) : 'æœªæ‰“å¡';
    eveningState.textContent = s.evening ? ('å·²æ‰“å¡ ' + fmt(s.evening)) : 'æœªæ‰“å¡';
    const last = s.evening || s.morning;
    medNote.textContent = last ? ('æœ€è¿‘è®°å½•ï¼š'+fmt(last)) : 'æœ€è¿‘è®°å½•ï¼šæ— ';
  }

  morningBtn.addEventListener('click', ()=>{
    const s = load(); s.morning = Date.now(); save(s);
    ping('æ—©ä¸Šå·²æ‰“å¡ï¼Œä¹–ã€‚');
  });
  eveningBtn.addEventListener('click', ()=>{
    const s = load(); s.evening = Date.now(); save(s);
    ping('æ™šä¸Šå·²æ‰“å¡ï¼Œè®°å¾—ç¡å‰æ•´ç†è¯ç›’ã€‚');
  });
  render();
})();

/* å°æç¤º/åå¸ */
function ping(text){
  const n = document.createElement('div');
  n.textContent = text;
  Object.assign(n.style,{ position:'fixed', left:'50%', bottom:'40px',
    transform:'translateX(-50%)', padding:'10px 14px', borderRadius:'12px',
    color:'var(--ink)', background:'rgba(255,255,255,.10)', border:'1px solid rgba(255,255,255,.16)',
    zIndex:9999
  });
  document.body.appendChild(n);
  setTimeout(()=>{ n.style.transition='all .4s'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(10px)'; },1600);
  setTimeout(()=> n.remove(),2200);
}

/* ================== å…¼å®¹æ€§è¯´æ˜ï¼šè¾“å…¥æ¡†ä»å¯é€‰ï¼Œé•¿æŒ‰èœå•å±è”½ï¼ŒåŒå‡»æ”¾å¤§è¢«æ‹¦æˆª ================== */

/* é¢å¤–ï¼šé˜²æ­¢é”®ç›˜è¾“å…¥å› ä¸º user-select:none å¯¼è‡´å…‰æ ‡ä¸å¯é€‰çš„é—®é¢˜ï¼ˆå·²å…è®¸è¾“å…¥æ¡†é€‰ä¸­æ–‡å­—ï¼‰ */

/* End of script */
</script>
</body>
</html>
