<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<!-- é˜²æ­¢ç¼©æ”¾ä¸è§¦æ‘¸ç¼©æ”¾ï¼ˆå¼ºåˆ¶ç¦æ­¢ï¼‰ -->
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="theme-color" content="#0d0f14" />
<title>ç»™ç‹¸ç‹¸çš„è¿Ÿåˆ°ç”Ÿæ—¥ç¤¼ç‰© Â· å¤ä»¥æ˜¼ï¼ˆv2ï¼‰</title>

<!-- æ›¿æ¢ä¸‹é¢å›¾æ ‡ä¸ºä½ è‡ªå·±çš„ 180x180 pngï¼Œæˆ–æ”¾åœ¨åŒç›®å½• -->
<link rel="apple-touch-icon" href="apple-touch-icon.png" />
<!-- ç®€æ˜“ manifest å ä½ï¼ˆå¯æ›¿æ¢æˆ–æ‰©å±•ï¼‰ -->
<link rel="manifest" href="manifest.json" />

<style>
:root{
  --bg: radial-gradient(1200px 800px at 70% 10%, #1e2533, #0d0f14 45%);
  --ink: #e9edf8;
  --ink-soft: #b9c1d8;
  --accent: #8ab4ff;
  --glass: rgba(255,255,255,.06);
  --blur: 18px;
  --radius-lg: 22px;
  --dock-height: 84px;
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
}

/* reset */
*{box-sizing:border-box; -webkit-tap-highlight-color: transparent}
html,body{height:100%; margin:0; -webkit-font-smoothing:antialiased}
body{
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC","Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  color:var(--ink); background:var(--bg) fixed; overflow:hidden;
  /* ä½¿ç”¨ svh å…¼å®¹ Safari å®‰å…¨åŒºåŸŸ */
  min-height:100svh;
  -webkit-user-select:none; touch-action:manipulation;
}

/* æ•´ä½“å®¹å™¨ï¼Œæ¨¡ä»¿ä¸€éƒ¨æ‰‹æœº */
#scene{ position:relative; width:100%; height:100%; padding-top:calc(var(--safe-top) + 12px); padding-bottom:calc(var(--safe-bottom) + 12px); display:flex; justify-content:center; align-items:flex-start; }

/* phone å®¹å™¨â€”â€”ä¿ç•™åŸè§†è§‰ */
.phone{ width:100%; max-width:480px; height:calc(100svh - (var(--safe-top) + var(--safe-bottom) + 24px)); border-radius:20px; overflow:hidden; position:relative; display:flex; flex-direction:column; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); box-shadow:0 30px 60px rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.06) }

/* é¡¶éƒ¨åŒºåŸŸ */
.header{ display:flex; gap:12px; align-items:center; padding:14px 16px; position:relative; z-index:6 }
.avatar{ width:40px; height:40px; border-radius:12px; background:var(--glass); display:grid; place-items:center; backdrop-filter:blur(var(--blur)); border:1px solid rgba(255,255,255,.12) }
.title b{ font-size:16px }
.title small{ color:var(--ink-soft); font-size:13px }

/* å†…å®¹åŒºå¯æ»šåŠ¨ */
.wrap{ flex:1; overflow:auto; padding:12px 16px 18px; -webkit-overflow-scrolling:touch; }

/* å¡ç‰‡æ ·å¼ */
.card{ background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border-radius:16px; padding:14px; margin-bottom:12px; border:1px solid rgba(255,255,255,.08); backdrop-filter: blur(var(--blur)); box-shadow: 0 10px 30px rgba(0,0,0,.28) }

/* ä»¿çŸ­ä¿¡æ°”æ³¡ */
.msg{ max-width:76%; padding:10px 12px; border-radius:14px; margin:10px 0; word-break:break-word; box-shadow:0 8px 20px rgba(0,0,0,.25) }
.me{ margin-left:auto; background: linear-gradient(180deg, rgba(138,180,255,.78), rgba(138,180,255,.36)); border:1px solid rgba(138,180,255,.54) }
.u{ background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); border:1px solid rgba(255,255,255,.16) }
.msg small{ display:block; margin-top:6px; color:var(--ink-soft); font-size:12px }

/* æŒ‰é’® */
.btn{ padding:10px 12px; border-radius:12px; border:0; cursor:pointer; background:linear-gradient(180deg,#d6e2ff,#9ec0ff); color:#061022; box-shadow:0 8px 22px rgba(0,0,0,.26) }
.btn.ghost{ background: rgba(255,255,255,.06); color:var(--ink); border:1px solid rgba(255,255,255,.10) }

/* éšè— dockï¼ˆç”¨æˆ·ä¸éœ€è¦ï¼‰â€”â€”å·²ç§»é™¤DOMï¼ŒCSSä¿ç•™ä»¥é˜²æ—§æ ·å¼æ®‹ç•™ */
.dock{ display:none !important }

/* å°æŠ€å·§æç¤º */
.hint{ position:fixed; right:10px; top:calc(var(--safe-top) + 12px); padding:8px 12px; border-radius:12px; background:rgba(255,255,255,.06); color:var(--ink-soft); border:1px solid rgba(255,255,255,.12); z-index:9 }

/* breathing modal */
.breath-modal{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:50; pointer-events:none }
.breath-card{ width:92%; max-width:420px; background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.06)); padding:18px; border-radius:16px; backdrop-filter:blur(14px); border:1px solid rgba(255,255,255,.08); pointer-events:auto; text-align:center }
.breath-ring{ width:140px; height:140px; margin:12px auto; border-radius:50%; display:grid; place-items:center; background: radial-gradient(circle at 30% 30%, rgba(138,180,255,.18), rgba(181,140,255,.06)); transition:transform 850ms cubic-bezier(.2,.9,.2,1) }

/* ç”¨è¯æ‰“å¡ */
.med-line{ display:flex; gap:8px; align-items:center; margin-top:10px }
.med-btn{ flex:1; padding:10px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); color:var(--ink) }

/* canvas ç‰¹æ•ˆè¦†ç›–ï¼Œç¦æ­¢æ‹¦æˆªç‚¹å‡» */
#fx{ position:absolute; inset:0; pointer-events:none; z-index:2 }

/* é€‚é…æ›´å¤§å± */
@media (min-width:740px){
  body{ background-size:cover }
  .phone{ height:88vh; border-radius:28px }
}
</style>
</head>
<body>
<div id="scene">
  <div class="phone" role="application" aria-label="ç‹¸ç‹¸ç¤¼ç‰©å°ç½‘é¡µ">
    <canvas id="fx"></canvas>

    <div class="header" aria-hidden="false">
      <div class="avatar"><span>ğŸ¾</span></div>
      <div class="title">
        <b>ç»™ç‹¸ç‹¸çš„ç”Ÿæ—¥å°ç½‘é¡µ</b>
        <small id="modeNote">æ‰§èˆ°é¹…åœ¨çº¿ Â· è¿Ÿåˆ°çš„ç¤¼ç‰©</small>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <button id="btnConfetti" class="btn" title="æ”¾çƒŸèŠ±" aria-label="æ”¾çƒŸèŠ±">ğŸ†</button>
        <button id="btnBreathToggle" class="btn ghost" title="æ·±å‘¼å¸ç»ƒä¹ " aria-label="æ·±å‘¼å¸">å‘¼å¸ç»ƒä¹ </button>
        <button id="btnMedCheck" class="btn ghost" title="ç”¨è¯æ‰“å¡" aria-label="ç”¨è¯æ‰“å¡">åƒè¯æ‰“å¡</button>
      </div>
    </div>

    <div class="wrap" id="wrap">
      <div class="card" id="hero">
        <h2 style="margin:0 0 8px">ç”Ÿæ—¥å¿«ä¹ï¼Œå‰¯èˆ°ç‹¸ ğŸ‚</h2>
        <p style="margin:0;color:var(--ink-soft)">æ„¿ä½ ç¡å¾—é¦™ï¼Œåƒå¾—é¥±ï¼Œæ¯å¤©éƒ½èƒ½è¢«æ¸©æŸ”å®ˆæŠ¤ã€‚</p>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="btnPing" class="btn ghost">å–µçˆªæé†’</button>
          <button id="btnMode" class="btn ghost">æ‰§èˆ°é¹…æ¨¡å¼</button>
        </div>
      </div>

      <div class="msg u">å‰¯èˆ°ç‹¸ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚ä»Šå¤©æˆ‘æ¥è´Ÿè´£å®ˆæŠ¤ä½ çš„åˆç¡ã€‚<small>08:08</small></div>
      <div class="msg me">æ”¶åˆ°ï½è®°å¾—åƒé¥­ï¼Œä¸ç„¶æˆ‘æ¥ç½šä½ ç¡å¤¹æ¿ã€‚<small>08:10</small></div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">å¿ƒæ„¿æ¸…å•</h3>
        <div style="display:flex;gap:8px">
          <input id="wishTxt" type="text" placeholder="å†™ä¸‹ä»Šå¤©æƒ³è¦çš„å°å¿ƒæ„¿â€¦" style="flex:1;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--ink)" />
          <button id="wishAdd" class="btn">åŠ å…¥</button>
        </div>
        <div id="wishes" style="margin-top:10px;display:flex;flex-direction:column;gap:8px"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="wishClear" class="btn ghost">æ¸…ç©º</button>
          <button id="wishMock" class="btn ghost">çµæ„Ÿ</button>
        </div>
      </div>

      <div class="card" id="medCard">
        <h3 style="margin:0 0 8px 0">ç”¨è¯ / æ‰“å¡</h3>
        <div style="color:var(--ink-soft)">æ—© / æ™š æ‰“å¡ä¼šè¢«è®°å½•åœ¨æœ¬æœºï¼Œå…ç™»å½•ï¼Œéšæ—¶æ¢å¤ã€‚</div>
        <div class="med-line">
          <button id="medMorning" class="med-btn">æ—©ä¸Šï¼š<span id="morningState">æœªæ‰“å¡</span></button>
          <button id="medEvening" class="med-btn">æ™šä¸Šï¼š<span id="eveningState">æœªæ‰“å¡</span></button>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="medHistory" class="btn ghost">æŸ¥çœ‹å†å²</button>
          <button id="medReset" class="btn ghost">é‡ç½®ä»Šæ—¥</button>
        </div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px 0">éº»è–¯è§’</h3>
        <p style="margin:0;color:var(--ink-soft)">å°å‰¯å®˜ç°åœ¨ï¼š<span id="catState">æ­£åœ¨æ²™å‘ä¸Šç¡è§‰</span></p>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button data-cat="åƒç½ç½ä¸­" class="btn ghost">æŠ•å–‚ç½ç½</button>
          <button data-cat="å·¡é€»é˜³å°" class="btn ghost">é˜³å°å·¡é€»</button>
          <button data-cat="æ™’å¤ªé˜³" class="btn ghost">æ™’å¤ªé˜³</button>
        </div>
      </div>

      <div class="card" style="text-align:center">
        <div style="font-size:13px;color:var(--ink-soft)">â€” From å¤ä»¥æ˜¼ â€”</div>
      </div>
    </div>
  </div>

  <!-- è‡ªåŠ¨æç¤ºï¼ˆå¯éšè—ï¼‰ -->
  <div class="hint" id="hint">å°æŠ€å·§ï¼šä¿å­˜åˆ°ä¸»å±å¹•åå¯å…¨å±è¿è¡Œï¼ŒåŒå‡»æ”¾çƒŸèŠ±</div>

  <!-- æ·±å‘¼å¸æ¨¡æ€ï¼ˆé»˜è®¤éšè—ï¼‰ -->
  <div class="breath-modal" id="breathModal" aria-hidden="true" style="display:none">
    <div class="breath-card" role="dialog" aria-modal="true">
      <div style="font-size:15px">è·Ÿç€æˆ‘åšï¼šå¸æ°” Â· å±ä½ Â· å‘¼æ°”</div>
      <div class="breath-ring" id="breathRing"><div style="font-size:18px;color:var(--ink)"><span id="breathLabel">å‡†å¤‡</span></div></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
        <button id="breathStart" class="btn">å¼€å§‹</button>
        <button id="breathStop" class="btn ghost">åœæ­¢</button>
      </div>
      <div style="margin-top:10px;color:var(--ink-soft);font-size:13px">å¯é€‰æ‹© 4-4-6 / 4-4-4 èŠ‚å¥</div>
    </div>
  </div>
</div>

<script>
/* --------------------------
   åŸºç¡€ç‰¹æ€§ & ä¿®å¤è¯´æ˜ï¼ˆå·²å®ç°ï¼‰
   - ç¦æ­¢ç¼©æ”¾ï¼šmeta viewport (maximum-scale=1)ï¼Œå¹¶æ‹¦æˆªåŒå‡»
   - ç‚¹å‡»ç©¿é€ï¼šcanvas #fx pointer-events:none
   - touch-action: manipulation å·²åœ¨ body è®¾å®šï¼Œå¢åŠ äº‹ä»¶æ‹¦æˆªä¿è¯åŒå‡»ä¸æ”¾å¤§
   -------------------------- */

/* é˜²æ­¢åŒå‡»æ”¾å¤§ï¼ˆçŸ­æ—¶é—´å†…ç¬¬äºŒæ¬¡è§¦æ‘¸é˜»æ­¢é»˜è®¤ï¼‰ */
(function(){
  let last = 0;
  document.addEventListener('touchend', function(e){
    const now = Date.now();
    if (now - last < 300) {
      e.preventDefault();
    }
    last = now;
  }, {passive:false});
})();

/* canvas å½©å¸¦ç‰¹æ•ˆï¼ˆä¿ç•™ï¼Œpointer-events:noneï¼‰ */
(function(){
  const cvs = document.getElementById('fx');
  if(!cvs) return;
  const ctx = cvs.getContext('2d');
  let DPR = window.devicePixelRatio || 1;
  function resize(){ cvs.width = window.innerWidth * DPR; cvs.height = window.innerHeight * DPR; cvs.style.width = window.innerWidth+'px'; cvs.style.height = window.innerHeight+'px'; }
  resize(); window.addEventListener('resize', resize);
  let parts = [];
  function burst(x,y){ for(let i=0;i<60;i++){ parts.push({ x:x*DPR, y:y*DPR, vx:(Math.random()-0.5)*8, vy:(Math.random()-0.9)*-8, life:60+Math.random()*40, hue: 190 + Math.random()*120 }); } }
  function tick(){
    ctx.clearRect(0,0,cvs.width,cvs.height);
    for(let i=parts.length-1;i>=0;i--){
      const p = parts[i];
      p.vy += 0.2; p.x+=p.vx; p.y+=p.vy; p.life--;
      ctx.globalAlpha = Math.max(p.life/80,0);
      ctx.fillStyle = `hsl(${p.hue},80%,60%)`;
      ctx.beginPath(); ctx.arc(p.x,p.y,2.2,0,Math.PI*2); ctx.fill();
      if(p.life<=0) parts.splice(i,1);
    }
    requestAnimationFrame(tick);
  }
  tick();
  document.getElementById('btnConfetti').addEventListener('click', (e)=> burst(window.innerWidth/2, 160));
})();

/* hint è‡ªåŠ¨éšè— & å¯å†æ¬¡æ˜¾ç¤º */
(function(){
  const H = document.getElementById('hint');
  if(!H) return;
  setTimeout(()=>{ H.style.transition='opacity .6s'; H.style.opacity='0'; setTimeout(()=>H.style.display='none',700) }, 4200);
  // å³ä¸Šè§’æŒ‰é’®å¯é‡æ–°æ˜¾ç¤ºï¼ˆç»‘å®šåˆ° btnPingï¼‰
  document.getElementById('btnPing').addEventListener('click', ()=> {
    if(H.style.display==='none'){ H.style.display='block'; H.style.opacity='1'; setTimeout(()=> H.style.opacity='0',4200); setTimeout(()=> H.style.display='none',4800); }
    else { alert('å–µçˆªæé†’ï¼šæˆ‘åœ¨è¿™å„¿ï½'); }
  });
})();

/* å¿ƒæ„¿æ¸…å•ï¼ˆlocalStorageï¼‰ */
(function(){
  const KEY='lili_wishes_v2';
  const listEl=document.getElementById('wishes'), txt=document.getElementById('wishTxt'), add=document.getElementById('wishAdd');
  const clr=document.getElementById('wishClear'), mock=document.getElementById('wishMock');
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch(e){return[]} }
  function save(a){ localStorage.setItem(KEY, JSON.stringify(a)) }
  function render(){
    const arr = load(); listEl.innerHTML='';
    arr.forEach((it,idx)=>{
      const row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center';
      row.style.background='rgba(255,255,255,.03)'; row.style.padding='8px'; row.style.borderRadius='10px';
      const left=document.createElement('div'); left.textContent=it.text; left.style.color='var(--ink)';
      const right=document.createElement('div'); right.style.display='flex'; right.style.gap='8px';
      const done=document.createElement('button'); done.className='btn ghost'; done.textContent=it.done?'æ¢å¤':'å®Œæˆ';
      done.onclick=()=>{ arr[idx].done = !arr[idx].done; save(arr); render(); };
      const del=document.createElement('button'); del.className='btn ghost'; del.textContent='åˆ é™¤'; del.onclick=()=>{ arr.splice(idx,1); save(arr); render(); };
      right.append(done,del); row.append(left,right); listEl.append(row);
    });
  }
  add.addEventListener('click', ()=>{ const v=txt.value.trim(); if(!v) return; const a=load(); a.unshift({text:v,done:false}); save(a); txt.value=''; render(); });
  txt.addEventListener('keydown', e=>{ if(e.key==='Enter') add.click()});
  clr.addEventListener('click', ()=>{ localStorage.removeItem(KEY); render(); });
  mock.addEventListener('click', ()=>{ const seeds=['KFCå¤–å–','æŠ±éº»è–¯ç¡è§‰','ä¿®ç½‘é¡µå…¨å±','çœ‹æ–°ç•ªä¸€é›†']; txt.value=seeds[Math.floor(Math.random()*seeds.length)]; });
  render();
})();

/* éº»è–¯æŒ‰é’® */
document.querySelectorAll('[data-cat]').forEach(btn=>{
  btn.addEventListener('click', ()=> { document.getElementById('catState').textContent = btn.dataset.cat; ping('ğŸ± çŠ¶æ€æ›´æ–°ï¼š'+btn.dataset.cat); });
});

/* ping æç¤ºå‡½æ•° */
function ping(text){ const n=document.createElement('div'); n.textContent=text; Object.assign(n.style,{position:'fixed',left:'50%',bottom:'80px',transform:'translateX(-50%)',padding:'10px 14px',borderRadius:'12px',background:'rgba(255,255,255,.06)',color:'var(--ink)',border:'1px solid rgba(255,255,255,.12)',zIndex:999}); document.body.appendChild(n); setTimeout(()=>{ n.style.transition='all .5s ease'; n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(10px)'; },1600); setTimeout(()=>n.remove(),2200); }

/* æ‰§èˆ°é¹…æ¨¡å¼åˆ‡æ¢ï¼ˆåªæ”¹å˜æ–‡æ¡ˆä¸éƒ¨åˆ†è‰²ç³»ï¼‰ */
document.getElementById('btnMode').addEventListener('click', ()=>{
  document.documentElement.style.setProperty('--accent','#b58cff');
  document.getElementById('modeNote').innerHTML = 'æ‰§èˆ°é¹…æ¨¡å¼ Â· èˆ°æ¡¥åœ¨çº¿';
  ping('ğŸ›¡ æ‰§èˆ°é¹…å·²ä¸Šçº¿');
});

/* breathing æ·±å‘¼å¸åŠŸèƒ½ */
(function(){
  const modal=document.getElementById('breathModal'), ring=document.getElementById('breathRing'), label=document.getElementById('breathLabel');
  const start=document.getElementById('breathStart'), stop=document.getElementById('breathStop');
  let running=false, timer=null, phase=0; // 0 inhale,1 hold,2 exhale
  const pattern = [4000,4000,6000]; // ms for inhale-hold-exhale default

  function show(){ modal.style.display='flex'; modal.setAttribute('aria-hidden','false'); }
  function hide(){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); cancel(); }

  function animateOnce(){
    // inhale
    phase=0; label.textContent='å¸æ°”'; ring.style.transform='scale(1.28)';
    timer = setTimeout(()=>{ phase=1; label.textContent='å±ä½'; ring.style.transform='scale(1.12)'; timer = setTimeout(()=>{ phase=2; label.textContent='å‘¼æ°”'; ring.style.transform='scale(.84)'; timer = setTimeout(()=>{ if(running) animateOnce(); else { ring.style.transform='scale(1)'; label.textContent='å‡†å¤‡'; } }, pattern[2]); }, pattern[1]); }, pattern[0]);
  }
  function cancel(){ running=false; if(timer) clearTimeout(timer); ring.style.transform='scale(1)'; label.textContent='å‡†å¤‡'; }
  start.addEventListener('click', ()=>{
    if(running) return; running=true; animateOnce();
  });
  stop.addEventListener('click', ()=>{ cancel(); hide(); });

  document.getElementById('btnBreathToggle').addEventListener('click', ()=>{ if(modal.style.display==='flex'){ hide(); } else { show(); } });
})();

/* ç”¨è¯æ‰“å¡ï¼ˆlocalStorageï¼Œè®°å½•æ¯å¤©æ—©æ™šçŠ¶æ€ï¼‰ */
(function(){
  const KEY='lili_med_v2';
  const morningBtn=document.getElementById('medMorning'), eveningBtn=document.getElementById('medEvening');
  const morningState=document.getElementById('morningState'), eveningState=document.getElementById('eveningState');
  const hist=document.getElementById('medHistory'), reset=document.getElementById('medReset');

  function load(){
    try{
      const raw = JSON.parse(localStorage.getItem(KEY) || '{}');
      // ä½¿ç”¨æ—¥æœŸå…³é”®ï¼ŒYYYY-MM-DD
      const today = (new Date()).toISOString().slice(0,10);
      return raw[today] || {morning:false,evening:false,history:raw};
    }catch(e){ return {morning:false,evening:false,history:{}} }
  }
  function saveState(s){
    try{
      const raw = JSON.parse(localStorage.getItem(KEY) || '{}');
      const today = (new Date()).toISOString().slice(0,10);
      raw[today] = { morning: s.morning, evening: s.evening, ts: Date.now() };
      localStorage.setItem(KEY, JSON.stringify(raw));
    }catch(e){}
  }
  function render(){
    const s = load();
    morningState.textContent = s.morning ? 'å·²æ‰“å¡' : 'æœªæ‰“å¡';
    eveningState.textContent = s.evening ? 'å·²æ‰“å¡' : 'æœªæ‰“å¡';
    morningBtn.style.opacity = s.morning ? '0.7' : '1';
    eveningBtn.style.opacity = s.evening ? '0.7' : '1';
  }
  morningBtn.addEventListener('click', ()=>{
    const s = load(); s.morning = !s.morning; saveState(s); render(); ping('æ—©ä¸Šæ‰“å¡å·²æ›´æ–°');
  });
  eveningBtn.addEventListener('click', ()=>{
    const s = load(); s.evening = !s.evening; saveState(s); render(); ping('æ™šä¸Šæ‰“å¡å·²æ›´æ–°');
  });
  hist.addEventListener('click', ()=>{
    // ç®€æ˜“å±•ç¤ºæœ€è¿‘ 7 å¤©è®°å½•
    try{
      const raw = JSON.parse(localStorage.getItem(KEY) || '{}');
      const keys = Object.keys(raw).sort().slice(-7);
      if(keys.length===0) return alert('æš‚æ— è®°å½•');
      let msg = 'æœ€è¿‘è®°å½•ï¼š\n';
      keys.forEach(k=>{ msg += `${k}ï¼šæ—© ${raw[k].morning? 'âœ“':'âœ—'}  æ™š ${raw[k].evening? 'âœ“':'âœ—'}\n`; });
      alert(msg);
    }catch(e){ alert('è¯»å–å¤±è´¥') }
  });
  reset.addEventListener('click', ()=>{
    const s = {morning:false,evening:false}; saveState(s); render(); ping('å·²é‡ç½®ä»Šæ—¥æ‰“å¡');
  });
  render();
})();

/* åˆ é™¤/ç§»é™¤ Dockï¼ˆå¦‚æœæ—§ DOM è¿˜å­˜åœ¨ï¼‰â€”â€”æœ¬ç‰ˆç›´æ¥æ²¡æœ‰ DOM */
/* å…¶ä»–å°äº¤äº’ */
document.getElementById('btnPing').addEventListener('click', ()=> ping('ğŸ¾ å–µï¼šæˆ‘åœ¨è¿™å„¿ï½'));

/* ä½¿ header çš„æŒ‰é’®å’Œ wrap ä¸­æŒ‰é’®åœ¨ Safari PWA ä¸­æ­£å¸¸å“åº”ï¼ˆå·²é€šè¿‡ touch-action ä¸åŒå‡»æ‹¦æˆªè§£å†³ï¼‰ */
(function(){
  // é˜²æ­¢ click å»¶è¿Ÿä¸é˜»å¡ï¼šå¯¹æ‰€æœ‰ button ä½¿ç”¨ fastclick-like å¤„ç†ï¼ˆä»…åœ¨è§¦æ‘¸è®¾å¤‡ï¼‰
  function fastify(btn){
    if(!btn) return;
    let touchStart=false;
    btn.addEventListener('touchstart', ()=> touchStart=true, {passive:true});
    btn.addEventListener('click', (e)=>{ /* normal click */ });
  }
  document.querySelectorAll('button').forEach(fastify);
})();

/* ä½¿åˆ†äº«åˆ°ä¸»å±å¹•å¯å‡ºç° iconï¼ˆmanifest å ä½ï¼‰ï¼š
   å¦‚æœä½ æƒ³ç¦»çº¿å®Œæ•´ PWAï¼šè¡¥å…… manifest.json æŒ‡å‘ iconsï¼Œä¸”åœ¨æœåŠ¡å™¨ä¸Šåš httpsã€‚
*/

/* æœ€åï¼šç¦æ­¢æ»šåŠ¨ç©¿é€ modalï¼ˆå·²æ—  modal æŒç»­æ˜¾ç¤ºæ—¶ï¼‰ */
document.addEventListener('touchmove', function(e){
  if(document.querySelector('.breath-modal[style*="display: flex"]')) {
    e.preventDefault();
  }
}, {passive:false});

</script>
</body>
</html>
