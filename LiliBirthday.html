<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>ç‹¸ç‹¸ç”Ÿæ—¥ç¤¼ç‰© Â· Lili Birthday</title>

  <!-- iOS PWA å…¨å± & çŠ¶æ€æ æ ·å¼ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0b0c10"/>

  <!-- åŸºç¡€æ ·å¼ï¼šæ¶²æ€ç»ç’ƒ + iOS é£æ ¼åœ†è§’/æŠ•å½±/å®‰å…¨åŒº -->
  <style>
    :root{
      --bg:#0b0c10;                 /* èƒŒæ™¯åŸºè‰²ï¼ˆæ·±ï¼‰ */
      --fg:#eaf2ff;                 /* å‰æ™¯æ–‡å­— */
      --muted:#a6b0c0;              /* æ¬¡è¦æ–‡å­— */
      --tint: 255 255 255;          /* ç»ç’ƒé«˜å…‰ */
      --glass: 255 255 255 / .08;   /* ç»ç’ƒåº•è‰² */
      --blur: 18px;                 /* èƒŒæ™¯æ¨¡ç³Š */
      --radius: 18px;               /* å…¨å±€åœ†è§’ */
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --accent:#7aa0ff;             /* ç‚¹ç¼€è‰² */
      --good:#7bffb2;               /* æˆåŠŸè‰² */
      --danger:#ff799a;             /* å±é™©è‰² */
      --safe-bottom: env(safe-area-inset-bottom, 0);
      --safe-top: env(safe-area-inset-top, 0);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--fg);
      background: var(--bg) center/cover fixed no-repeat;
      font: 16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Noto Sans CJK SC","Microsoft YaHei",sans-serif;
      overflow: hidden;
    }

    /* æ¸å˜è’™ç‰ˆå ä¸€å±‚ï¼Œä¾¿äºå£çº¸æ¸…æ™°åŒæ—¶å¯è¯» */
    .backdrop{
      position: fixed; inset:0;
      background:
        radial-gradient(1200px 700px at 80% 10%, rgba(255,255,255,.04), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
      pointer-events: none;
      z-index: 0;
    }

    /* é¡¶æ ï¼ˆæ²‰æµ¸ï¼Œç•™å®‰å…¨åŒºï¼‰ */
    .topbar{
      position: fixed; left:12px; right:12px; top: calc(8px + var(--safe-top));
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius: calc(var(--radius) + 6px);
      background: rgba(var(--tint) / .06);
      backdrop-filter: blur(var(--blur)) saturate(120%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(120%);
      box-shadow: var(--shadow);
      z-index: 5;
    }
    .topbar .title{
      font-weight:700; letter-spacing:.3px;
    }
    .topbar .sub{ color:var(--muted); font-size:12px; }

    /* ä¸»å†…å®¹åŒºï¼ˆå¯æ»šåŠ¨ï¼‰ */
    .page{
      position: fixed; inset:0;
      padding:
        calc(64px + var(--safe-top)) 14px
        calc(96px + var(--safe-bottom)) 14px;   /* é¢„ç•™åº•æ ç©ºé—´ */
      overflow: auto; scroll-behavior: smooth;
      z-index: 1;
    }

    /* ç”Ÿæ—¥å¡ç‰‡ */
    .card{
      background: rgba(var(--tint) / .08);
      backdrop-filter: blur(var(--blur)) saturate(130%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(130%);
      border-radius: calc(var(--radius) + 10px);
      box-shadow: var(--shadow);
      padding:18px;
      display:grid; gap:12px;
      border: 1px solid rgba(255,255,255,.08);
    }
    .card h1{
      margin:0; font-size:20px; line-height:1.25;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{
      padding:8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.08);
      font-size: 13px; color:#e8f2ff;
    }
    .btn{
      border:0; cursor:pointer; user-select:none;
      padding:12px 16px; border-radius: 14px;
      font-weight:600; color:#0b0c10;
      background: linear-gradient(180deg, #cfe3ff, #8fb2ff);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 8px 22px rgba(22,70,255,.25);
    }
    .btn.ghost{
      color:#eaf2ff;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.1);
      box-shadow:none;
    }
    .grid{ display:grid; gap:12px; }
    @media (min-width: 680px){
      .grid{ grid-template-columns: 1.2fr .8fr; align-items:start; }
    }

    /* å¿ƒæ„¿ç°¿ */
    .wish{
      display:grid; gap:10px;
    }
    .wish textarea{
      width:100%; min-height:92px; resize:vertical;
      padding:12px; color:var(--fg);
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      outline: none;
    }
    .wish .list{
      display:grid; gap:8px; margin-top:6px;
    }
    .wish .item{
      display:flex; align-items:center; gap:8px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      padding:10px 12px; border-radius: 12px;
    }
    .wish .item input[type="checkbox"]{
      width:18px; height:18px;
      accent-color: var(--accent);
    }
    .wish .item .txt{ flex:1; }

    /* èŠå¤©åŒºï¼ˆiOSçŸ­ä¿¡é£ï¼‰ */
    .chat{
      display:grid; gap:10px;
    }
    .bubble{
      max-width: 82%;
      padding:10px 12px; border-radius: 18px;
      position: relative; line-height:1.3;
      word-break: break-word;
      border: 1px solid rgba(255,255,255,.08);
    }
    .bubble.me{
      margin-left:auto; color:#0b0c10;
      background: rgba(255,255,255,.9);
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }
    .bubble.u{
      margin-right:auto; color:#eaf2ff;
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* æ‚¬æµ®åº•æ ï¼ˆå¤´åƒç‹¬ç«‹ + ä¸‰æŒ‰é’®ï¼‰ */
    .dock{
      position: fixed; left:12px; right:12px;
      bottom: calc(10px + var(--safe-bottom));
      height:72px; z-index: 10;
      display:flex; align-items:center; justify-content:center;
    }
    .dock .bar{
      position:absolute; inset:0;
      background: rgba(var(--tint) / .08);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(var(--blur)) saturate(130%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(130%);
      border-radius: calc(var(--radius) + 12px);
      box-shadow: var(--shadow);
    }
    .dock .btns{
      position:relative; display:flex; gap:12px; z-index:1;
    }
    .dock button.icon{
      width:44px; height:44px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center; font-size:20px; color:#eaf2ff;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.3);
      cursor:pointer;
    }
    .dock .avatar{
      position:absolute; top:-26px; left:50%;
      translate:-50% 0;
      width:56px; height:56px; border-radius:22px;
      background: radial-gradient(120% 120% at 30% 20%, #fff8, #fff1 50%, #fff0 60%),
                  url('') center/cover no-repeat, linear-gradient(135deg,#ffd2e3,#b0c7ff);
      border: 3px solid rgba(255,255,255,.7);
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .dock .avatar::after{
      content:"ç‹¸"; position:absolute; inset:auto 6px 6px 6px;
      font-size:12px; font-weight:700; color:#0b0c10;
      background:#fff; padding:2px 6px; border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.2);
    }

    /* æµ®åŠ¨å·¥å…·æ¡ */
    .tools{
      position: fixed; right:12px; bottom: calc(96px + var(--safe-bottom));
      display:grid; gap:10px; z-index: 9;
    }
    .tools .chip{
      padding:10px 12px; border-radius: 12px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:#eaf2ff; font-size:13px; cursor:pointer;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* å£çº¸ä¸Šä¼ æŒ‰é’®ï¼ˆéšè—åŸinputï¼‰ */
    #wall{ display:none; }

    /* å°æç¤º */
    .hint{
      font-size:12px; color:var(--muted);
    }

    /* å½©çº¸ç²’å­ç”»å¸ƒ */
    canvas#fx{
      position: fixed; inset:0; pointer-events:none; z-index:2;
    }
  </style>
</head>
<body>
  <div class="backdrop"></div>

  <!-- ç²’å­/çƒŸèŠ±å±‚ -->
  <canvas id="fx"></canvas>

  <!-- é¡¶æ  -->
  <div class="topbar">
    <div style="flex:1">
      <div class="title">ğŸ‚ ç‹¸ç‹¸ç”Ÿæ—¥ç©ºé—´</div>
      <div class="sub">â€œä¸–ç•Œä¸Šæœ€å¯çˆ±çš„ç‹¸ç‹¸ä¸“å±â€</div>
    </div>
    <button class="btn ghost" id="a2hs">æ·»åŠ åˆ°ä¸»å±</button>
  </div>

  <!-- å†…å®¹æ»šåŠ¨åŒº -->
  <main class="page" id="page">
    <div class="grid">

      <!-- å·¦ï¼šè´ºå¡ + èŠå¤© -->
      <section class="card">
        <h1>ç”Ÿæ—¥å¿«ä¹ï¼Œç‹¸ç‹¸ï¼</h1>
        <div class="row">
          <span class="pill">æ¶²æ€ç»ç’ƒÂ·æ‚¬æµ®åº•æ </span>
          <span class="pill">iOS å®‰å…¨åŒºé€‚é…</span>
          <span class="pill">å£çº¸è‡ªå®šä¹‰</span>
          <span class="pill">æ„¿æœ›æ¸…å•</span>
        </div>
        <div class="row">
          <button class="btn" id="party">æ”¾å½©å¸¦/çƒŸèŠ±</button>
          <button class="btn ghost" id="toggleTheme">æµ…/æ·±åˆ‡æ¢</button>
          <label class="btn ghost" for="wall">æ›´æ¢å£çº¸</label>
          <input id="wall" type="file" accept="image/*">
        </div>

        <div class="hint">æç¤ºï¼šiOS Safari ç”¨â€œåˆ†äº« â†’ æ·»åŠ åˆ°ä¸»å±å¹•â€å¯è·å–æ²‰æµ¸å…¨å±æ•ˆæœã€‚</div>

        <div class="chat" id="chat">
          <div class="bubble u">æŒ‡æŒ¥å°å·²å°±ç»ªï¼Œç­‰ç‹¸é•¿å®˜ä¸Šèˆ°ã€‚ğŸ«¡</div>
          <div class="bubble me">æ”¶åˆ°ï¼ä»Šå¤©è¦åƒå¥½ã€ç¡å¥½ã€è¶…å¼€å¿ƒï½</div>
        </div>
      </section>

      <!-- å³ï¼šå¿ƒæ„¿ç°¿ -->
      <section class="card">
        <h1>å¿ƒæ„¿ç°¿</h1>
        <div class="wish">
          <textarea id="wishText" placeholder="å†™ä¸‹ä»Šå¤©çš„å°å°æ„¿æœ›ï¼ˆæ¯”å¦‚ï¼šKFC ç–¯ç‹‚æ˜ŸæœŸå››ã€æŠ±æŠ±ã€éº»è–¯ä¸æŒ æ²™å‘â€¦ï¼‰"></textarea>
          <div class="row">
            <button class="btn" id="addWish">æ·»åŠ å¿ƒæ„¿</button>
            <button class="btn ghost" id="clearDone">æ¸…é™¤å·²å®Œæˆ</button>
          </div>
          <div class="list" id="wishList"></div>
        </div>
      </section>

    </div>
  </main>

  <!-- æ‚¬æµ®åº•æ ï¼ˆå¤´åƒç‹¬ç«‹ + ä¸‰æŒ‰é’®ï¼‰ -->
  <nav class="dock" aria-label="Floating Dock">
    <div class="bar" aria-hidden="true"></div>
    <div class="avatar" id="avatar" title="ç‚¹æˆ‘æ¢è§’æ ‡"></div>
    <div class="btns">
      <button class="icon" id="bChat" title="å‘ä¸€æ¡ç¥ç¦">ğŸ’¬</button>
      <button class="icon" id="bGift" title="è®¸ä¸ªæ„¿">ğŸ</button>
      <button class="icon" id="bPlay" title="æ’­æ”¾ç”Ÿæ—¥å½©è›‹">ğŸµ</button>
    </div>
  </nav>

  <!-- ä¾§è¾¹å·¥å…· -->
  <aside class="tools">
    <div class="chip" id="today">ğŸˆ ç”Ÿæ—¥æ‰“å¡</div>
    <div class="chip" id="save">ğŸ’¾ ä¿å­˜æ•°æ®</div>
    <div class="chip" id="reset">ğŸ§¹ æ¸…ç©ºæ•°æ®</div>
  </aside>

  <!-- é€»è¾‘è„šæœ¬ -->
  <script>
  ;(()=>{
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    /* ========= æœ¬åœ°å­˜å‚¨ ========= */
    const store = {
      set(k,v){ localStorage.setItem('lili::'+k, JSON.stringify(v)); },
      get(k,d){ try{ return JSON.parse(localStorage.getItem('lili::'+k)) ?? d }catch{ return d } },
      del(k){ localStorage.removeItem('lili::'+k); },
      clr(){ Object.keys(localStorage).forEach(k=> k.startsWith('lili::') && localStorage.removeItem(k)) }
    };

    /* ========= å£çº¸ ========= */
    const wall = $('#wall');
    const body = document.body;

    function applyWallpaper(url){
      body.style.backgroundImage = url ? `url(${url})` : '';
      store.set('wall', url);
    }
    wall.addEventListener('change', e=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const r = new FileReader();
      r.onload = () => applyWallpaper(`"${r.result}"`);
      r.readAsDataURL(file);
      e.target.value = '';
    });

    /* ========= ä¸»é¢˜ ========= */
    const themes = {
      dark: {
        bg:'#0b0c10', tint:'255 255 255', glass:'255 255 255 / .08', fg:'#eaf2ff', muted:'#a6b0c0'
      },
      light:{
        bg:'#eef3ff', tint:'0 0 0', glass:'0 0 0 / .08', fg:'#0b0c10', muted:'#4a5363'
      }
    };
    function setTheme(name){
      const t = themes[name]; if(!t) return;
      document.documentElement.style.setProperty('--bg', t.bg);
      document.documentElement.style.setProperty('--tint', t.tint);
      document.documentElement.style.setProperty('--glass', t.glass);
      document.documentElement.style.setProperty('--fg', t.fg);
      document.documentElement.style.setProperty('--muted', t.muted);
      store.set('theme', name);
    }
    $('#toggleTheme').addEventListener('click', ()=>{
      const cur = store.get('theme','dark');
      setTheme(cur === 'dark' ? 'light' : 'dark');
    });

    /* ========= èŠå¤© ========= */
    const chat = $('#chat');
    function pushBubble(txt, me=false){
      const div = document.createElement('div');
      div.className = 'bubble ' + (me?'me':'u');
      div.textContent = txt;
      chat.appendChild(div);
      setTimeout(()=> div.scrollIntoView({behavior:'smooth', block:'end'}), 10);
    }
    $('#bChat').addEventListener('click', ()=>{
      const t = new Date();
      const hh = String(t.getHours()).padStart(2,'0');
      const mm = String(t.getMinutes()).padStart(2,'0');
      pushBubble(`ã€${hh}:${mm}ã€‘ç»™ç‹¸é•¿å®˜çš„æ±‡æŠ¥ï¼šä»Šå¤©ä¹Ÿå¾ˆå–œæ¬¢ä½ ã€‚`, true);
    });

    /* ========= æ„¿æœ›æ¸…å• ========= */
    const wishText = $('#wishText');
    const wishList = $('#wishList');

    function renderWishes(arr){
      wishList.innerHTML = '';
      arr.forEach((w,i)=>{
        const li = document.createElement('div');
        li.className = 'item';
        li.innerHTML = `
          <input type="checkbox" ${w.done?'checked':''} data-i="${i}">
          <div class="txt">${w.text}</div>
          <button class="btn ghost" data-rm="${i}" style="padding:8px 10px">åˆ é™¤</button>
        `;
        wishList.appendChild(li);
      });
    }
    function getWishes(){ return store.get('wishes',[]); }
    function setWishes(arr){ store.set('wishes',arr); renderWishes(arr); }

    $('#addWish').addEventListener('click', ()=>{
      const v = wishText.value.trim();
      if(!v) return;
      const arr = getWishes();
      arr.push({ text:v, done:false, at:Date.now() });
      setWishes(arr);
      wishText.value = '';
      pushBubble(`å·²è®°å½•å¿ƒæ„¿ï¼šâ€œ${v}â€`, false);
    });
    wishList.addEventListener('change', e=>{
      if(e.target.matches('input[type="checkbox"]')){
        const i = +e.target.dataset.i;
        const arr = getWishes(); if(!arr[i]) return;
        arr[i].done = e.target.checked;
        setWishes(arr);
      }
    });
    wishList.addEventListener('click', e=>{
      if(e.target.dataset.rm){
        const i = +e.target.dataset.rm;
        const arr = getWishes(); arr.splice(i,1); setWishes(arr);
      }
    });
    $('#clearDone').addEventListener('click', ()=>{
      const left = getWishes().filter(x=>!x.done);
      setWishes(left);
    });

    /* ========= æ‰“å¡/ä¿å­˜/é‡ç½® ========= */
    $('#today').addEventListener('click', ()=>{
      const d = new Date(); const tag = d.toLocaleDateString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit'});
      pushBubble(`ğŸˆ ç”Ÿæ—¥æ‰“å¡ Â· ${tag} Â· è®°å¾—å–æ°´ + åƒå¥½åƒçš„ã€‚`, true);
    });
    $('#save').addEventListener('click', ()=>{
      // å®é™…ä¸Šæ‰€æœ‰æ•°æ®å®æ—¶ä¿å­˜ï¼Œè¿™é‡Œåªåšæç¤º
      pushBubble('âœ… å·²ä¿å­˜åˆ°æœ¬åœ°ï¼ˆå£çº¸/ä¸»é¢˜/å¿ƒæ„¿/èŠå¤©ï¼‰ã€‚', false);
    });
    $('#reset').addEventListener('click', ()=>{
      if(confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰ç‹¸ç‹¸çš„æ•°æ®å—ï¼Ÿï¼ˆå£çº¸/ä¸»é¢˜/å¿ƒæ„¿/èŠå¤©ï¼‰')){
        store.clr(); location.reload();
      }
    });

    /* ========= ç”Ÿæ—¥å½©å¸¦/çƒŸèŠ± ========= */
    const canvas = $('#fx'), ctx = canvas.getContext('2d');
    let W, H, parts = [], sparks = [];
    function resize(){
      W = canvas.width = innerWidth * devicePixelRatio;
      H = canvas.height = innerHeight * devicePixelRatio;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
    }
    addEventListener('resize', resize); resize();

    function rnd(a,b){ return Math.random()*(b-a)+a }
    function confetti(){
      for(let i=0;i<140;i++){
        parts.push({
          x:rnd(0,W), y:rnd(-H*0.2,0),
          vx:rnd(-0.6,0.6), vy:rnd(0.6,1.6),
          w:rnd(6,16)*devicePixelRatio, h:rnd(8,22)*devicePixelRatio,
          r:rnd(0,Math.PI), s:rnd(0.9,1.6),
          c:`hsl(${rnd(200,320)},90%,${rnd(55,75)}%)`
        });
      }
    }
    function firework(){
      const cx = rnd(W*0.2,W*0.8), cy = rnd(H*0.2,H*0.5);
      for(let i=0;i<120;i++){
        const a = rnd(0,Math.PI*2), sp = rnd(1.2,3.2);
        sparks.push({
          x:cx, y:cy, vx:Math.cos(a)*sp, vy:Math.sin(a)*sp,
          life:rnd(40,80), c:`hsl(${rnd(0,360)},100%,70%)`
        });
      }
    }
    function tick(){
      ctx.clearRect(0,0,W,H);

      // confetti
      parts.forEach(p=>{
        p.x += p.vx * 3; p.y += p.vy * 3; p.r += 0.03;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.r);
        ctx.fillStyle = p.c;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      });
      parts = parts.filter(p=> p.y < H + 50);

      // fireworks
      sparks.forEach(s=>{
        s.x += s.vx * 4; s.y += s.vy * 4; s.vy += 0.02; s.life -= 1;
        ctx.fillStyle = s.c;
        ctx.globalAlpha = Math.max(s.life/80, 0);
        ctx.beginPath(); ctx.arc(s.x, s.y, 2*devicePixelRatio, 0, Math.PI*2); ctx.fill();
        ctx.globalAlpha = 1;
      });
      sparks = sparks.filter(s=> s.life>0);

      requestAnimationFrame(tick);
    }
    tick();

    let partyToggle = false;
    $('#party').addEventListener('click', ()=>{
      partyToggle = !partyToggle;
      if(partyToggle){ confetti(); firework(); firework(); }
      else { parts=[]; sparks=[]; }
    });
    $('#bPlay').addEventListener('click', ()=>{ confetti(); firework(); });

    /* ========= è®¸æ„¿å¼¹çª—ï¼ˆæç®€ï¼‰ ========= */
    $('#bGift').addEventListener('click', ()=>{
      const v = prompt('å†™ä¸‹ä¸€ä¸ªä»Šå¤©çš„å°æ„¿æœ›å§ï½\nï¼ˆç¤ºä¾‹ï¼šä»Šæ™šåƒKFCï¼›éº»è–¯ä¸æŒ æ²™å‘ï¼›æŠ±æŠ±ååˆ†é’Ÿï¼‰');
      if(v && v.trim()){
        wishText.value = v.trim();
        $('#addWish').click();
      }
    });

    /* ========= Avatar è§’æ ‡åˆ‡æ¢ ========= */
    const avatar = $('#avatar');
    let tag = 0, tags = ['ç‹¸','å–µ','Lili','ğŸ‚','ğŸ’¤','ğŸ'];
    avatar.addEventListener('click', ()=>{
      tag = (tag+1)%tags.length;
      avatar.style.setProperty('--after', tags[tag]);
      avatar.setAttribute('data-tag', tags[tag]);
      avatar.innerHTML = ''; // çº¯èƒŒæ™¯+è§’æ ‡
      avatar.style.backgroundImage = getComputedStyle(avatar).backgroundImage;
      avatar.style.setProperty('content','"' + tags[tag] + '"');
      avatar.style.setProperty('--tag', '"' + tags[tag] + '"');
      avatar.style.setProperty('--tag-index', tag);
      avatar.style.setProperty('--tag-color', '#000');
      avatar.style.setProperty('--tag-bg', '#fff');
      avatar.style.setProperty('--tag-shadow', '0 6px 14px rgba(0,0,0,.25)');
    });

    /* ========= A2HS æç¤ºï¼ˆå®‰å“åŸç”Ÿæ”¯æŒï¼ŒiOS å¼•å¯¼ï¼‰ ========= */
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e;
    });
    $('#a2hs').addEventListener('click', async ()=>{
      if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt = null; }
      else{
        alert('iPhoneï¼šç‚¹â€œåˆ†äº«â€â†’â€œæ·»åŠ åˆ°ä¸»å±å¹•â€å³å¯å…¨å±ä½¿ç”¨ã€‚');
      }
    });

    /* ========= åˆå§‹æ•°æ®æ¢å¤ ========= */
    (function init(){
      // ä¸»é¢˜
      setTheme(store.get('theme','dark'));
      // å£çº¸
      const w = store.get('wall', null); if(w) applyWallpaper(w);
      // å¿ƒæ„¿
      renderWishes(getWishes());
      // æ¬¢è¿è¯­ä¸€æ¬¡
      const welcomed = store.get('welcomed', false);
      if(!welcomed){
        setTimeout(()=>{
          pushBubble('èˆ°é•¿å·²æŠŠè¿™è‰˜å°ç½‘é¡µäº¤ç»™ç‹¸é•¿å®˜ï¼Œç¥å¤©å¤©å¿«ä¹ã€‚', false);
          pushBubble('PSï¼šåº•æ æ˜¯â€œæ‚¬æµ® + ç»ç’ƒ + å¤´åƒç‹¬ç«‹ä½â€ï¼Œæ­£åˆç‹¸ç‹¸å£å‘³ã€‚', false);
          confetti();
          store.set('welcomed', true);
        }, 500);
      }
    })();
  })();
  </script>
</body>
</html>
