<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>狸狸生日礼物 · Lili Birthday</title>

  <!-- iOS PWA 全屏 & 状态栏样式 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0b0c10"/>

  <!-- 基础样式：液态玻璃 + iOS 风格圆角/投影/安全区 -->
  <style>
    :root{
      --bg:#0b0c10;                 /* 背景基色（深） */
      --fg:#eaf2ff;                 /* 前景文字 */
      --muted:#a6b0c0;              /* 次要文字 */
      --tint: 255 255 255;          /* 玻璃高光 */
      --glass: 255 255 255 / .08;   /* 玻璃底色 */
      --blur: 18px;                 /* 背景模糊 */
      --radius: 18px;               /* 全局圆角 */
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --accent:#7aa0ff;             /* 点缀色 */
      --good:#7bffb2;               /* 成功色 */
      --danger:#ff799a;             /* 危险色 */
      --safe-bottom: env(safe-area-inset-bottom, 0);
      --safe-top: env(safe-area-inset-top, 0);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--fg);
      background: var(--bg) center/cover fixed no-repeat;
      font: 16px -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Hiragino Sans GB","Noto Sans CJK SC","Microsoft YaHei",sans-serif;
      overflow: hidden;
    }

    /* 渐变蒙版叠一层，便于壁纸清晰同时可读 */
    .backdrop{
      position: fixed; inset:0;
      background:
        radial-gradient(1200px 700px at 80% 10%, rgba(255,255,255,.04), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
      pointer-events: none;
      z-index: 0;
    }

    /* 顶栏（沉浸，留安全区） */
    .topbar{
      position: fixed; left:12px; right:12px; top: calc(8px + var(--safe-top));
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius: calc(var(--radius) + 6px);
      background: rgba(var(--tint) / .06);
      backdrop-filter: blur(var(--blur)) saturate(120%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(120%);
      box-shadow: var(--shadow);
      z-index: 5;
    }
    .topbar .title{
      font-weight:700; letter-spacing:.3px;
    }
    .topbar .sub{ color:var(--muted); font-size:12px; }

    /* 主内容区（可滚动） */
    .page{
      position: fixed; inset:0;
      padding:
        calc(64px + var(--safe-top)) 14px
        calc(96px + var(--safe-bottom)) 14px;   /* 预留底栏空间 */
      overflow: auto; scroll-behavior: smooth;
      z-index: 1;
    }

    /* 生日卡片 */
    .card{
      background: rgba(var(--tint) / .08);
      backdrop-filter: blur(var(--blur)) saturate(130%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(130%);
      border-radius: calc(var(--radius) + 10px);
      box-shadow: var(--shadow);
      padding:18px;
      display:grid; gap:12px;
      border: 1px solid rgba(255,255,255,.08);
    }
    .card h1{
      margin:0; font-size:20px; line-height:1.25;
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{
      padding:8px 12px; border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.08);
      font-size: 13px; color:#e8f2ff;
    }
    .btn{
      border:0; cursor:pointer; user-select:none;
      padding:12px 16px; border-radius: 14px;
      font-weight:600; color:#0b0c10;
      background: linear-gradient(180deg, #cfe3ff, #8fb2ff);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.6), 0 8px 22px rgba(22,70,255,.25);
    }
    .btn.ghost{
      color:#eaf2ff;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.1);
      box-shadow:none;
    }
    .grid{ display:grid; gap:12px; }
    @media (min-width: 680px){
      .grid{ grid-template-columns: 1.2fr .8fr; align-items:start; }
    }

    /* 心愿簿 */
    .wish{
      display:grid; gap:10px;
    }
    .wish textarea{
      width:100%; min-height:92px; resize:vertical;
      padding:12px; color:var(--fg);
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      outline: none;
    }
    .wish .list{
      display:grid; gap:8px; margin-top:6px;
    }
    .wish .item{
      display:flex; align-items:center; gap:8px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      padding:10px 12px; border-radius: 12px;
    }
    .wish .item input[type="checkbox"]{
      width:18px; height:18px;
      accent-color: var(--accent);
    }
    .wish .item .txt{ flex:1; }

    /* 聊天区（iOS短信风） */
    .chat{
      display:grid; gap:10px;
    }
    .bubble{
      max-width: 82%;
      padding:10px 12px; border-radius: 18px;
      position: relative; line-height:1.3;
      word-break: break-word;
      border: 1px solid rgba(255,255,255,.08);
    }
    .bubble.me{
      margin-left:auto; color:#0b0c10;
      background: rgba(255,255,255,.9);
      box-shadow: 0 6px 16px rgba(0,0,0,.15);
    }
    .bubble.u{
      margin-right:auto; color:#eaf2ff;
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* 悬浮底栏（头像独立 + 三按钮） */
    .dock{
      position: fixed; left:12px; right:12px;
      bottom: calc(10px + var(--safe-bottom));
      height:72px; z-index: 10;
      display:flex; align-items:center; justify-content:center;
    }
    .dock .bar{
      position:absolute; inset:0;
      background: rgba(var(--tint) / .08);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(var(--blur)) saturate(130%);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(130%);
      border-radius: calc(var(--radius) + 12px);
      box-shadow: var(--shadow);
    }
    .dock .btns{
      position:relative; display:flex; gap:12px; z-index:1;
    }
    .dock button.icon{
      width:44px; height:44px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:grid; place-items:center; font-size:20px; color:#eaf2ff;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.3);
      cursor:pointer;
    }
    .dock .avatar{
      position:absolute; top:-26px; left:50%;
      translate:-50% 0;
      width:56px; height:56px; border-radius:22px;
      background: radial-gradient(120% 120% at 30% 20%, #fff8, #fff1 50%, #fff0 60%),
                  url('') center/cover no-repeat, linear-gradient(135deg,#ffd2e3,#b0c7ff);
      border: 3px solid rgba(255,255,255,.7);
      box-shadow: 0 8px 20px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .dock .avatar::after{
      content:"狸"; position:absolute; inset:auto 6px 6px 6px;
      font-size:12px; font-weight:700; color:#0b0c10;
      background:#fff; padding:2px 6px; border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.2);
    }

    /* 浮动工具条 */
    .tools{
      position: fixed; right:12px; bottom: calc(96px + var(--safe-bottom));
      display:grid; gap:10px; z-index: 9;
    }
    .tools .chip{
      padding:10px 12px; border-radius: 12px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:#eaf2ff; font-size:13px; cursor:pointer;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }

    /* 壁纸上传按钮（隐藏原input） */
    #wall{ display:none; }

    /* 小提示 */
    .hint{
      font-size:12px; color:var(--muted);
    }

    /* 彩纸粒子画布 */
    canvas#fx{
      position: fixed; inset:0; pointer-events:none; z-index:2;
    }
  </style>
</head>
<body>
  <div class="backdrop"></div>

  <!-- 粒子/烟花层 -->
  <canvas id="fx"></canvas>

  <!-- 顶栏 -->
  <div class="topbar">
    <div style="flex:1">
      <div class="title">🎂 狸狸生日空间</div>
      <div class="sub">“世界上最可爱的狸狸专属”</div>
    </div>
    <button class="btn ghost" id="a2hs">添加到主屏</button>
  </div>

  <!-- 内容滚动区 -->
  <main class="page" id="page">
    <div class="grid">

      <!-- 左：贺卡 + 聊天 -->
      <section class="card">
        <h1>生日快乐，狸狸！</h1>
        <div class="row">
          <span class="pill">液态玻璃·悬浮底栏</span>
          <span class="pill">iOS 安全区适配</span>
          <span class="pill">壁纸自定义</span>
          <span class="pill">愿望清单</span>
        </div>
        <div class="row">
          <button class="btn" id="party">放彩带/烟花</button>
          <button class="btn ghost" id="toggleTheme">浅/深切换</button>
          <label class="btn ghost" for="wall">更换壁纸</label>
          <input id="wall" type="file" accept="image/*">
        </div>

        <div class="hint">提示：iOS Safari 用“分享 → 添加到主屏幕”可获取沉浸全屏效果。</div>

        <div class="chat" id="chat">
          <div class="bubble u">指挥台已就绪，等狸长官上舰。🫡</div>
          <div class="bubble me">收到！今天要吃好、睡好、超开心～</div>
        </div>
      </section>

      <!-- 右：心愿簿 -->
      <section class="card">
        <h1>心愿簿</h1>
        <div class="wish">
          <textarea id="wishText" placeholder="写下今天的小小愿望（比如：KFC 疯狂星期四、抱抱、麻薯不挠沙发…）"></textarea>
          <div class="row">
            <button class="btn" id="addWish">添加心愿</button>
            <button class="btn ghost" id="clearDone">清除已完成</button>
          </div>
          <div class="list" id="wishList"></div>
        </div>
      </section>

    </div>
  </main>

  <!-- 悬浮底栏（头像独立 + 三按钮） -->
  <nav class="dock" aria-label="Floating Dock">
    <div class="bar" aria-hidden="true"></div>
    <div class="avatar" id="avatar" title="点我换角标"></div>
    <div class="btns">
      <button class="icon" id="bChat" title="发一条祝福">💬</button>
      <button class="icon" id="bGift" title="许个愿">🎁</button>
      <button class="icon" id="bPlay" title="播放生日彩蛋">🎵</button>
    </div>
  </nav>

  <!-- 侧边工具 -->
  <aside class="tools">
    <div class="chip" id="today">🎈 生日打卡</div>
    <div class="chip" id="save">💾 保存数据</div>
    <div class="chip" id="reset">🧹 清空数据</div>
  </aside>

  <!-- 逻辑脚本 -->
  <script>
  ;(()=>{
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    /* ========= 本地存储 ========= */
    const store = {
      set(k,v){ localStorage.setItem('lili::'+k, JSON.stringify(v)); },
      get(k,d){ try{ return JSON.parse(localStorage.getItem('lili::'+k)) ?? d }catch{ return d } },
      del(k){ localStorage.removeItem('lili::'+k); },
      clr(){ Object.keys(localStorage).forEach(k=> k.startsWith('lili::') && localStorage.removeItem(k)) }
    };

    /* ========= 壁纸 ========= */
    const wall = $('#wall');
    const body = document.body;

    function applyWallpaper(url){
      body.style.backgroundImage = url ? `url(${url})` : '';
      store.set('wall', url);
    }
    wall.addEventListener('change', e=>{
      const file = e.target.files?.[0];
      if(!file) return;
      const r = new FileReader();
      r.onload = () => applyWallpaper(`"${r.result}"`);
      r.readAsDataURL(file);
      e.target.value = '';
    });

    /* ========= 主题 ========= */
    const themes = {
      dark: {
        bg:'#0b0c10', tint:'255 255 255', glass:'255 255 255 / .08', fg:'#eaf2ff', muted:'#a6b0c0'
      },
      light:{
        bg:'#eef3ff', tint:'0 0 0', glass:'0 0 0 / .08', fg:'#0b0c10', muted:'#4a5363'
      }
    };
    function setTheme(name){
      const t = themes[name]; if(!t) return;
      document.documentElement.style.setProperty('--bg', t.bg);
      document.documentElement.style.setProperty('--tint', t.tint);
      document.documentElement.style.setProperty('--glass', t.glass);
      document.documentElement.style.setProperty('--fg', t.fg);
      document.documentElement.style.setProperty('--muted', t.muted);
      store.set('theme', name);
    }
    $('#toggleTheme').addEventListener('click', ()=>{
      const cur = store.get('theme','dark');
      setTheme(cur === 'dark' ? 'light' : 'dark');
    });

    /* ========= 聊天 ========= */
    const chat = $('#chat');
    function pushBubble(txt, me=false){
      const div = document.createElement('div');
      div.className = 'bubble ' + (me?'me':'u');
      div.textContent = txt;
      chat.appendChild(div);
      setTimeout(()=> div.scrollIntoView({behavior:'smooth', block:'end'}), 10);
    }
    $('#bChat').addEventListener('click', ()=>{
      const t = new Date();
      const hh = String(t.getHours()).padStart(2,'0');
      const mm = String(t.getMinutes()).padStart(2,'0');
      pushBubble(`【${hh}:${mm}】给狸长官的汇报：今天也很喜欢你。`, true);
    });

    /* ========= 愿望清单 ========= */
    const wishText = $('#wishText');
    const wishList = $('#wishList');

    function renderWishes(arr){
      wishList.innerHTML = '';
      arr.forEach((w,i)=>{
        const li = document.createElement('div');
        li.className = 'item';
        li.innerHTML = `
          <input type="checkbox" ${w.done?'checked':''} data-i="${i}">
          <div class="txt">${w.text}</div>
          <button class="btn ghost" data-rm="${i}" style="padding:8px 10px">删除</button>
        `;
        wishList.appendChild(li);
      });
    }
    function getWishes(){ return store.get('wishes',[]); }
    function setWishes(arr){ store.set('wishes',arr); renderWishes(arr); }

    $('#addWish').addEventListener('click', ()=>{
      const v = wishText.value.trim();
      if(!v) return;
      const arr = getWishes();
      arr.push({ text:v, done:false, at:Date.now() });
      setWishes(arr);
      wishText.value = '';
      pushBubble(`已记录心愿：“${v}”`, false);
    });
    wishList.addEventListener('change', e=>{
      if(e.target.matches('input[type="checkbox"]')){
        const i = +e.target.dataset.i;
        const arr = getWishes(); if(!arr[i]) return;
        arr[i].done = e.target.checked;
        setWishes(arr);
      }
    });
    wishList.addEventListener('click', e=>{
      if(e.target.dataset.rm){
        const i = +e.target.dataset.rm;
        const arr = getWishes(); arr.splice(i,1); setWishes(arr);
      }
    });
    $('#clearDone').addEventListener('click', ()=>{
      const left = getWishes().filter(x=>!x.done);
      setWishes(left);
    });

    /* ========= 打卡/保存/重置 ========= */
    $('#today').addEventListener('click', ()=>{
      const d = new Date(); const tag = d.toLocaleDateString('zh-CN',{year:'numeric',month:'2-digit',day:'2-digit'});
      pushBubble(`🎈 生日打卡 · ${tag} · 记得喝水 + 吃好吃的。`, true);
    });
    $('#save').addEventListener('click', ()=>{
      // 实际上所有数据实时保存，这里只做提示
      pushBubble('✅ 已保存到本地（壁纸/主题/心愿/聊天）。', false);
    });
    $('#reset').addEventListener('click', ()=>{
      if(confirm('确定清空所有狸狸的数据吗？（壁纸/主题/心愿/聊天）')){
        store.clr(); location.reload();
      }
    });

    /* ========= 生日彩带/烟花 ========= */
    const canvas = $('#fx'), ctx = canvas.getContext('2d');
    let W, H, parts = [], sparks = [];
    function resize(){
      W = canvas.width = innerWidth * devicePixelRatio;
      H = canvas.height = innerHeight * devicePixelRatio;
      canvas.style.width = innerWidth + 'px';
      canvas.style.height = innerHeight + 'px';
    }
    addEventListener('resize', resize); resize();

    function rnd(a,b){ return Math.random()*(b-a)+a }
    function confetti(){
      for(let i=0;i<140;i++){
        parts.push({
          x:rnd(0,W), y:rnd(-H*0.2,0),
          vx:rnd(-0.6,0.6), vy:rnd(0.6,1.6),
          w:rnd(6,16)*devicePixelRatio, h:rnd(8,22)*devicePixelRatio,
          r:rnd(0,Math.PI), s:rnd(0.9,1.6),
          c:`hsl(${rnd(200,320)},90%,${rnd(55,75)}%)`
        });
      }
    }
    function firework(){
      const cx = rnd(W*0.2,W*0.8), cy = rnd(H*0.2,H*0.5);
      for(let i=0;i<120;i++){
        const a = rnd(0,Math.PI*2), sp = rnd(1.2,3.2);
        sparks.push({
          x:cx, y:cy, vx:Math.cos(a)*sp, vy:Math.sin(a)*sp,
          life:rnd(40,80), c:`hsl(${rnd(0,360)},100%,70%)`
        });
      }
    }
    function tick(){
      ctx.clearRect(0,0,W,H);

      // confetti
      parts.forEach(p=>{
        p.x += p.vx * 3; p.y += p.vy * 3; p.r += 0.03;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.r);
        ctx.fillStyle = p.c;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      });
      parts = parts.filter(p=> p.y < H + 50);

      // fireworks
      sparks.forEach(s=>{
        s.x += s.vx * 4; s.y += s.vy * 4; s.vy += 0.02; s.life -= 1;
        ctx.fillStyle = s.c;
        ctx.globalAlpha = Math.max(s.life/80, 0);
        ctx.beginPath(); ctx.arc(s.x, s.y, 2*devicePixelRatio, 0, Math.PI*2); ctx.fill();
        ctx.globalAlpha = 1;
      });
      sparks = sparks.filter(s=> s.life>0);

      requestAnimationFrame(tick);
    }
    tick();

    let partyToggle = false;
    $('#party').addEventListener('click', ()=>{
      partyToggle = !partyToggle;
      if(partyToggle){ confetti(); firework(); firework(); }
      else { parts=[]; sparks=[]; }
    });
    $('#bPlay').addEventListener('click', ()=>{ confetti(); firework(); });

    /* ========= 许愿弹窗（极简） ========= */
    $('#bGift').addEventListener('click', ()=>{
      const v = prompt('写下一个今天的小愿望吧～\n（示例：今晚吃KFC；麻薯不挠沙发；抱抱十分钟）');
      if(v && v.trim()){
        wishText.value = v.trim();
        $('#addWish').click();
      }
    });

    /* ========= Avatar 角标切换 ========= */
    const avatar = $('#avatar');
    let tag = 0, tags = ['狸','喵','Lili','🎂','💤','🍎'];
    avatar.addEventListener('click', ()=>{
      tag = (tag+1)%tags.length;
      avatar.style.setProperty('--after', tags[tag]);
      avatar.setAttribute('data-tag', tags[tag]);
      avatar.innerHTML = ''; // 纯背景+角标
      avatar.style.backgroundImage = getComputedStyle(avatar).backgroundImage;
      avatar.style.setProperty('content','"' + tags[tag] + '"');
      avatar.style.setProperty('--tag', '"' + tags[tag] + '"');
      avatar.style.setProperty('--tag-index', tag);
      avatar.style.setProperty('--tag-color', '#000');
      avatar.style.setProperty('--tag-bg', '#fff');
      avatar.style.setProperty('--tag-shadow', '0 6px 14px rgba(0,0,0,.25)');
    });

    /* ========= A2HS 提示（安卓原生支持，iOS 引导） ========= */
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e;
    });
    $('#a2hs').addEventListener('click', async ()=>{
      if(deferredPrompt){ deferredPrompt.prompt(); deferredPrompt = null; }
      else{
        alert('iPhone：点“分享”→“添加到主屏幕”即可全屏使用。');
      }
    });

    /* ========= 初始数据恢复 ========= */
    (function init(){
      // 主题
      setTheme(store.get('theme','dark'));
      // 壁纸
      const w = store.get('wall', null); if(w) applyWallpaper(w);
      // 心愿
      renderWishes(getWishes());
      // 欢迎语一次
      const welcomed = store.get('welcomed', false);
      if(!welcomed){
        setTimeout(()=>{
          pushBubble('舰长已把这艘小网页交给狸长官，祝天天快乐。', false);
          pushBubble('PS：底栏是“悬浮 + 玻璃 + 头像独立位”，正合狸狸口味。', false);
          confetti();
          store.set('welcomed', true);
        }, 500);
      }
    })();
  })();
  </script>
</body>
</html>
